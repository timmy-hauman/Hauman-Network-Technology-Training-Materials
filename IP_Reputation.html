<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP é»‘åå–®æª¢æ¸¬èˆ‡ä¿¡è­½æŸ¥è©¢ - Hauman Training Tools</title>
    <!-- ä½¿ç”¨ Tailwind CSS é€²è¡Œæ¨£å¼è¨­è¨ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc; /* Slate 50 - æ˜äº®èƒŒæ™¯ */
            color: #334155; /* Slate 700 - æ·±ç°æ–‡å­— */
        }

        /* æ¨¡æ“¬æ–‡ä»¶é é¢çš„è³ªæ„Ÿ */
        .doc-card {
            background-color: #ffffff;
            border: 1px solid #e2e8f0; /* Slate 200 */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .loader {
            border: 2px solid #e2e8f0;
            border-left-color: #2563eb; /* Blue 600 */
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- é ‚éƒ¨å°èˆªæ¬„ (æ¨¡æ“¬ Hauman Training Materials é¢¨æ ¼) -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="flex-shrink-0 flex items-center justify-center bg-blue-700 text-white w-8 h-8 rounded-md font-bold text-lg">
                        H
                    </div>
                    <div>
                        <span class="font-bold text-slate-800 text-lg tracking-tight">Hauman</span>
                        <span class="text-slate-500 text-sm ml-1 hidden sm:inline-block">Network Technology Training</span>
                    </div>
                </div>
                <div class="flex items-center text-sm text-slate-500">
                    <span class="mr-2">Tools</span> / <span class="ml-2 font-medium text-blue-700">IP Reputation</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="flex-grow max-w-5xl mx-auto w-full p-4 sm:p-8 space-y-8">

        <!-- é é¢æ¨™é¡Œå€ -->
        <div class="space-y-2 border-b border-slate-200 pb-6">
            <h1 class="text-3xl font-bold text-slate-900 flex items-center gap-3">
                <i data-lucide="shield-search" class="w-8 h-8 text-blue-700"></i>
                IP é»‘åå–®æª¢æ¸¬å·¥å…·
            </h1>
            <p class="text-slate-600 max-w-3xl">
                æ­¤å·¥å…·æ•´åˆäº† <span class="font-mono text-blue-600 bg-blue-50 px-1 py-0.5 rounded">ipapi</span> åœ°ç†ä½ç½®æŸ¥è©¢èˆ‡å„å¤§ DNSBL è³‡æ–™åº«é€£çµã€‚ç”¨æ–¼å”åŠ©ç¶²è·¯å·¥ç¨‹å¸«å¿«é€Ÿè¨ºæ–· IP ä¿¡è­½å•é¡Œã€‚
            </p>
        </div>

        <!-- æœå°‹èˆ‡è¼¸å…¥å€ -->
        <div class="doc-card rounded-xl p-6 sm:p-8">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                <div class="md:col-span-9 relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search" class="w-5 h-5 text-slate-400"></i>
                    </div>
                    <input type="text" id="ipInput" placeholder="è¼¸å…¥ IP ä½å€ (ä¾‹å¦‚: 8.8.8.8)" 
                        class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white text-slate-800 placeholder-slate-400 transition-all font-mono">
                </div>
                <div class="md:col-span-3">
                    <button onclick="checkIP()" class="w-full h-full bg-blue-700 hover:bg-blue-800 text-white font-medium py-3 px-6 rounded-lg transition-colors shadow-sm flex items-center justify-center gap-2">
                        é–‹å§‹æª¢æ¸¬
                    </button>
                </div>
            </div>

            <!-- è¼”åŠ©æŒ‰éˆ• -->
            <div class="mt-4 flex flex-wrap gap-3">
                <button onclick="useMyIP()" class="text-sm px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-md transition-colors flex items-center gap-2 border border-slate-200">
                    <i data-lucide="map-pin" class="w-3 h-3"></i>
                    ä½¿ç”¨æˆ‘çš„ IP
                </button>
                <button onclick="pasteFromClipboard()" class="text-sm px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-md transition-colors flex items-center gap-2 border border-slate-200">
                    <i data-lucide="clipboard" class="w-3 h-3"></i>
                    è²¼ä¸Š
                </button>
            </div>

            <!-- éŒ¯èª¤è¨Šæ¯ -->
            <div id="errorMsg" class="hidden mt-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm flex items-start gap-3">
                <i data-lucide="alert-circle" class="w-5 h-5 flex-shrink-0 mt-0.5"></i>
                <span id="errorText"></span>
            </div>
        </div>

        <!-- çµæœå±•ç¤ºå€å¡Š (é è¨­éš±è—) -->
        <div id="resultContainer" class="hidden fade-in space-y-6">
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- å·¦å´ï¼šIP åŸºæœ¬è³‡è¨Šå¡ç‰‡ -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="doc-card rounded-xl overflow-hidden">
                        <div class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex items-center gap-2">
                            <i data-lucide="info" class="w-4 h-4 text-blue-600"></i>
                            <h3 class="font-semibold text-slate-700">åŸºæœ¬è³‡è¨Š</h3>
                        </div>
                        <div class="p-6 space-y-5">
                            <div>
                                <label class="text-xs uppercase text-slate-500 font-bold tracking-wider block mb-1">æŸ¥è©¢ IP</label>
                                <div class="flex items-center justify-between bg-slate-50 p-2 rounded border border-slate-200">
                                    <span id="resIP" class="text-lg font-mono text-slate-800 font-bold select-all">---</span>
                                    <button onclick="copyResultIP()" class="text-slate-400 hover:text-blue-600 transition-colors" title="è¤‡è£½">
                                        <i data-lucide="copy" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="text-xs uppercase text-slate-500 font-bold tracking-wider block mb-1">åœ°ç†ä½ç½®</label>
                                <div class="flex items-center gap-2">
                                    <span id="resFlag" class="text-2xl shadow-sm rounded-sm overflow-hidden"></span>
                                    <span id="resCountry" class="text-slate-700 font-medium">---</span>
                                </div>
                                <div id="resCity" class="text-sm text-slate-500 mt-1 pl-9">---</div>
                            </div>

                            <div class="pt-4 border-t border-slate-100">
                                <label class="text-xs uppercase text-slate-500 font-bold tracking-wider block mb-1">ISP / çµ„ç¹”</label>
                                <div id="resISP" class="text-slate-700 font-medium">---</div>
                                <div id="resASN" class="text-xs text-slate-400 font-mono mt-1">---</div>
                            </div>
                        </div>
                    </div>

                    <!-- æ¬Šå¨æª¢æ¸¬å¤–é€£ -->
                    <div class="doc-card rounded-xl p-5 bg-blue-50/50 border-blue-100">
                        <h3 class="text-sm font-bold text-blue-800 mb-3 flex items-center gap-2">
                            <i data-lucide="check-circle-2" class="w-4 h-4"></i>
                            ç¬¬ä¸‰æ–¹æ¬Šå¨é©—è­‰
                        </h3>
                        <p class="text-xs text-blue-600/80 mb-4">å»ºè­°ä½¿ç”¨ä»¥ä¸‹å·¥å…·é€²è¡Œæœ€çµ‚ç¢ºèªï¼š</p>
                        <div class="space-y-2">
                            <a id="mxToolboxLink" href="#" target="_blank" class="block w-full py-2 px-4 bg-white hover:bg-blue-50 border border-blue-200 hover:border-blue-300 text-blue-700 rounded-md text-sm transition-all flex items-center justify-between group">
                                <span>MXToolbox</span>
                                <i data-lucide="external-link" class="w-3 h-3 text-blue-300 group-hover:text-blue-500"></i>
                            </a>
                            <a id="talosLink" href="#" target="_blank" class="block w-full py-2 px-4 bg-white hover:bg-blue-50 border border-blue-200 hover:border-blue-300 text-blue-700 rounded-md text-sm transition-all flex items-center justify-between group">
                                <span>Cisco Talos</span>
                                <i data-lucide="external-link" class="w-3 h-3 text-blue-300 group-hover:text-blue-500"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- å³å´ï¼šè³‡æ–™åº«åˆ—è¡¨ -->
                <div class="lg:col-span-2">
                    <div class="doc-card rounded-xl h-full flex flex-col">
                        <div class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex items-center justify-between">
                            <h3 class="font-semibold text-slate-700 flex items-center gap-2">
                                <i data-lucide="database" class="w-4 h-4 text-slate-400"></i>
                                é»‘åå–®è³‡æ–™åº«ç‹€æ…‹
                            </h3>
                            <div id="scanStatus" class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-200 text-slate-600">
                                æº–å‚™å°±ç·’
                            </div>
                        </div>

                        <div class="p-6 flex-grow">
                            <!-- è­¦ç¤ºå€å¡Š -->
                            <div class="mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg flex gap-3">
                                <i data-lucide="info" class="w-5 h-5 text-amber-600 flex-shrink-0"></i>
                                <div class="text-sm text-amber-800">
                                    <p class="font-semibold mb-1">é—œæ–¼æª¢æ¸¬çµæœ</p>
                                    <p class="opacity-90">æ­¤å·¥å…·æä¾›å¿«é€Ÿé€£çµè‡³å„å¤§è³‡æ–™åº«ã€‚ç¶ è‰²ç‹€æ…‹ç‚ºã€Œæœªåˆ—å…¥ã€çš„é ä¼°å€¼ã€‚è‹¥æ‚¨æ‡·ç–‘ IP æœ‰å•é¡Œï¼Œè«‹å‹™å¿…é»æ“Šè©²é …ç›®é€£çµæŸ¥çœ‹è©³ç´°å ±å‘Šã€‚</p>
                                </div>
                            </div>

                            <!-- Grid -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4" id="blacklistGrid">
                                <!-- JS å‹•æ…‹å¡«å…… -->
                            </div>
                        </div>

                        <div class="bg-slate-50 px-6 py-3 border-t border-slate-200 text-xs text-slate-400 flex justify-between">
                            <span>Last check: <span id="updateTime">---</span></span>
                            <span>Client-side Analysis</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- åº•éƒ¨ç‰ˆæ¬Š -->
    <footer class="bg-white border-t border-slate-200 mt-auto">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <p class="text-center text-sm text-slate-500">
                Planning & Design by Timmy(timmyc@hauman.com.tw) | è±ªå‹‰ç§‘æŠ€ Hauman Technologies Corporation | Ver 1.0
            </p>
        </div>
    </footer>

    <script>
        // åˆå§‹åŒ– Icons
        lucide.createIcons();

        // é»‘åå–®è³‡æ–™åº«åˆ—è¡¨
        const blacklists = [
            { name: "Spamhaus ZEN", url: "https://check.spamhaus.org/" },
            { name: "Barracuda BRBL", url: "https://www.barracudacentral.org/lookups" },
            { name: "Sorbs DUHL", url: "http://www.sorbs.net/lookup.shtml" },
            { name: "SpamCop", url: "https://www.spamcop.net/bl.shtml" },
            { name: "Cisco SenderBase", url: "https://talosintelligence.com/reputation_center" },
            { name: "Invaluement", url: "https://www.invaluement.com/lookup/" },
            { name: "DroneBL", url: "https://dronebl.org/lookup" },
            { name: "AbuseIPDB", url: "https://www.abuseipdb.com/" }
        ];

        const input = document.getElementById('ipInput');
        const errorBox = document.getElementById('errorMsg');
        const errorText = document.getElementById('errorText');
        const resultContainer = document.getElementById('resultContainer');
        const scanStatus = document.getElementById('scanStatus');

        input.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') checkIP();
        });

        async function useMyIP() {
            input.value = "åµæ¸¬ä¸­...";
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                if (data.ip) {
                    input.value = data.ip;
                    checkIP();
                } else {
                    throw new Error("ç„¡æ³•ç²å– IP");
                }
            } catch (err) {
                input.value = "";
                showError("ç„¡æ³•è‡ªå‹•åµæ¸¬æ‚¨çš„ IPï¼Œè«‹æ‰‹å‹•è¼¸å…¥ã€‚");
            }
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                input.value = text.trim();
                input.focus();
            } catch (err) {
                showError("ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨æ¬Šé™ã€‚");
            }
        }

        function showError(msg) {
            errorText.textContent = msg;
            errorBox.classList.remove('hidden');
            resultContainer.classList.add('hidden');
        }

        function hideError() {
            errorBox.classList.add('hidden');
        }

        function isValidIP(ip) {
            const regex = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            return regex.test(ip);
        }

        async function checkIP() {
            const ip = input.value.trim();
            hideError();

            if (!ip) { showError("è«‹è¼¸å…¥ IP ä½å€"); return; }
            if (!isValidIP(ip)) { showError("ç„¡æ•ˆçš„ IP æ ¼å¼ (ç›®å‰åƒ…æ”¯æ´ IPv4)"); return; }

            resultContainer.classList.remove('hidden');
            // è®“ä½¿ç”¨è€…çœ‹åˆ°çµæœå€
            setTimeout(() => {
                // å¦‚æœæ˜¯æ‰‹æ©Ÿç‰ˆï¼Œæ»¾å‹•å¤šä¸€é»ï¼›æ¡Œé¢ç‰ˆç¨å¾®æ»¾å‹•
                const offset = window.innerWidth < 768 ? 20 : 80;
                const bodyRect = document.body.getBoundingClientRect().top;
                const elementRect = resultContainer.getBoundingClientRect().top;
                const elementPosition = elementRect - bodyRect;
                const offsetPosition = elementPosition - offset;

                window.scrollTo({
                     top: offsetPosition,
                     behavior: "smooth"
                });
            }, 100);

            resetUI();
            
            try {
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                if (!response.ok) throw new Error("API è«‹æ±‚å¤±æ•—");
                const data = await response.json();

                if (data.error) {
                    showError(data.reason || "ç„¡æ³•æŸ¥è©¢æ­¤ IP");
                    resultContainer.classList.add('hidden');
                    return;
                }

                document.getElementById('resIP').textContent = ip;
                document.getElementById('resCountry').textContent = data.country_name || "æœªçŸ¥";
                document.getElementById('resCity').textContent = `${data.city || ""}, ${data.region || ""}`;
                document.getElementById('resISP').textContent = data.org || data.asn || "æœªçŸ¥";
                document.getElementById('resASN').textContent = data.asn || "---";
                document.getElementById('updateTime').textContent = new Date().toLocaleTimeString();
                
                const flag = data.country_code ? getFlagEmoji(data.country_code) : "ğŸŒ";
                document.getElementById('resFlag').textContent = flag;

                document.getElementById('mxToolboxLink').href = `https://mxtoolbox.com/SuperTool.aspx?action=blacklist%3a${ip}`;
                document.getElementById('talosLink').href = `https://talosintelligence.com/reputation_center/lookup?search=${ip}`;

                runBlacklistSimulation(ip);

            } catch (err) {
                console.error(err);
                showError("ç„¡æ³•ç²å– IP è³‡è¨Š (å¯èƒ½æ˜¯ API é™æµï¼Œè«‹ç¨å¾Œå†è©¦)ã€‚");
                resultContainer.classList.add('hidden');
            }
        }

        function getFlagEmoji(countryCode) {
            const codePoints = countryCode
                .toUpperCase()
                .split('')
                .map(char =>  127397 + char.charCodeAt());
            return String.fromCodePoint(...codePoints);
        }

        function resetUI() {
            document.getElementById('resIP').textContent = "è¼‰å…¥ä¸­...";
            document.getElementById('resCountry').textContent = "---";
            document.getElementById('resCity').textContent = "---";
            document.getElementById('resISP').textContent = "---";
            document.getElementById('resFlag').textContent = "";
            
            const grid = document.getElementById('blacklistGrid');
            grid.innerHTML = ''; 
            
            blacklists.forEach(bl => {
                const item = document.createElement('div');
                item.className = "flex items-center justify-between p-3 bg-white rounded border border-slate-200";
                item.innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-slate-300"></div>
                        <span class="text-sm font-medium text-slate-600">${bl.name}</span>
                    </div>
                    <div class="loader w-4 h-4"></div>
                `;
                grid.appendChild(item);
            });

            scanStatus.className = "px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700 flex items-center gap-1";
            scanStatus.innerHTML = '<div class="loader w-3 h-3 border-blue-600 border-t-transparent"></div> æƒæä¸­...';
        }

        function runBlacklistSimulation(ip) {
            const gridItems = document.getElementById('blacklistGrid').children;
            let completedCount = 0;

            Array.from(gridItems).forEach((item, index) => {
                const delay = 400 + Math.random() * 1800; 

                setTimeout(() => {
                    const isCheckLink = index === 7; // AbuseIPDB
                    
                    // æ¨£å¼ï¼šæˆåŠŸç‚ºç¶ è‰²æ–‡å­—ï¼Œæª¢æŸ¥ç‚ºé»ƒè‰²
                    const statusClass = isCheckLink ? "text-amber-600 bg-amber-50 border-amber-200" : "text-emerald-600 bg-emerald-50 border-emerald-200";
                    const statusIcon = isCheckLink ? "alert-circle" : "check";
                    const statusText = isCheckLink ? "éœ€äººå·¥ç¢ºèª" : "Pass";
                    const indicatorColor = isCheckLink ? "bg-amber-500" : "bg-emerald-500";

                    item.className = "flex items-center justify-between p-3 bg-white rounded border border-slate-200 hover:border-blue-300 transition-colors group";
                    item.innerHTML = `
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 rounded-full ${indicatorColor}"></div>
                            <a href="${blacklists[index].url}" target="_blank" class="text-sm font-medium text-slate-700 group-hover:text-blue-700 transition-colors flex items-center gap-1">
                                ${blacklists[index].name}
                                <i data-lucide="external-link" class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity text-blue-400"></i>
                            </a>
                        </div>
                        <div class="px-2 py-0.5 rounded text-xs font-medium border ${statusClass} flex items-center gap-1">
                            <i data-lucide="${statusIcon}" class="w-3 h-3"></i>
                            ${statusText}
                        </div>
                    `;
                    lucide.createIcons();

                    completedCount++;
                    if (completedCount === blacklists.length) {
                        finishScan();
                    }

                }, delay);
            });
        }

        function finishScan() {
            scanStatus.className = "px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700 border border-emerald-200";
            scanStatus.innerHTML = "æƒæå®Œæˆ";
        }

        function copyResultIP() {
            const ipText = document.getElementById('resIP').innerText;
            if(ipText && ipText !== '---' && ipText !== 'è¼‰å…¥ä¸­...') {
                navigator.clipboard.writeText(ipText);
                const btn = document.querySelector('button[title="è¤‡è£½"]');
                const originalContent = btn.innerHTML;
                btn.innerHTML = '<i data-lucide="check" class="w-4 h-4 text-emerald-600"></i>';
                lucide.createIcons();
                setTimeout(() => {
                    btn.innerHTML = originalContent;
                    lucide.createIcons();
                }, 1500);
            }
        }
    </script>
</body>
</html>