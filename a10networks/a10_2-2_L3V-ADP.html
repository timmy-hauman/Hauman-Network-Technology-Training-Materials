<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A10 Networks Thunder 實戰課程 - L3V 與 ADP</title>
    
    <!-- Google Fonts: Rubik -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Mermaid JS (指定穩定版本) -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        a10blue: '#002758', // Congress Blue / Midnight Blue
                        a10magenta: '#C60C30', // Approximated Magenta
                        a10orange: '#F58220', // Approximated A10 Orange
                        a10light: '#F4F6F8',
                    },
                    fontFamily: {
                        sans: ['Rubik', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Rubik', sans-serif;
            background-color: #F4F6F8;
            color: #333;
        }
        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 2rem;
            overflow: hidden;
            border-top: 4px solid #002758;
        }
        .section-header {
            background: linear-gradient(90deg, #002758 0%, #1e3a8a 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
        }
        .highlight-text {
            color: #C60C30;
            font-weight: 600;
        }
        .concept-icon {
            color: #F58220;
        }
        .quiz-option {
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            background-color: #f0f9ff;
            border-color: #002758;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            background-color: white;
            padding: 20px;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-a10blue text-white shadow-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <!-- Simple Logo Representation -->
                <div class="bg-white rounded p-1">
                    <span class="text-a10blue font-bold text-xl px-2">A10</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-wide">A10 Networks Thunder 實戰課程</h1>
                    <p class="text-sm text-gray-300">第二階段：高可用性與進階派送 (Level 2 - Core Skills)</p>
                </div>
            </div>
            <div class="hidden md:block">
                <span class="bg-a10magenta px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wider">Advanced Topic</span>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <div class="bg-white border-b border-gray-200">
        <div class="container mx-auto px-6 py-10">
            <h2 class="text-3xl font-bold text-a10blue mb-4">L3V (Application Delivery Partitions)</h2>
            <p class="text-gray-600 max-w-3xl text-lg leading-relaxed">
                本章節將深入探討如何透過應用程式交付分割 (ADP) 技術，在單一台 A10 Thunder 設備上實現多租戶 (Multi-tenancy) 環境，達成資源隔離與高效管理的目標。
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">

        <!-- 1. 核心概念 -->
        <div class="section-card">
            <div class="section-header">
                <i class="fas fa-lightbulb concept-icon text-2xl mr-3"></i>
                <h3 class="text-xl font-bold">一、核心概念 (Concept)</h3>
            </div>
            <div class="p-8">
                <div class="mb-6">
                    <h4 class="text-a10blue font-bold text-lg mb-2"><i class="fas fa-quote-left text-a10orange mr-2"></i>一句話定義</h4>
                    <p class="text-gray-700 bg-gray-50 p-4 rounded-lg border-l-4 border-a10orange">
                        L3V (Layer 3 Virtualization) 是 A10 ACOS 系統中的虛擬化技術，它能將一台實體的 Thunder 設備切割成多個邏輯上獨立運作的 ADC (Application Delivery Controller)，彼此擁有獨立的配置檔與路由表。
                    </p>
                </div>
                <div>
                    <h4 class="text-a10blue font-bold text-lg mb-2"><i class="fas fa-building text-a10orange mr-2"></i>生活化比喻：商務辦公大樓</h4>
                    <p class="text-gray-700 leading-relaxed">
                        想像一台 A10 Thunder 就像一棟 <span class="highlight-text">頂級商務辦公大樓</span>。
                    </p>
                    <ul class="list-none mt-4 space-y-3">
                        <li class="flex items-start">
                            <span class="bg-a10blue text-white rounded-full h-6 w-6 flex items-center justify-center mr-3 mt-1 text-sm">1</span>
                            <div>
                                <strong>Shared Partition (共享分區) 就像「大樓物業管理處」：</strong><br>
                                他們掌管整棟大樓的基礎設施（水電、電梯、大門進出），也就是設備的實體介面 (Interface)、VLAN 和系統維護。所有進出的訪客（封包）都必須先經過大廳。
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-a10magenta text-white rounded-full h-6 w-6 flex items-center justify-center mr-3 mt-1 text-sm">2</span>
                            <div>
                                <strong>Private Partition (私有分區) 就像「各個承租戶的辦公室」：</strong><br>
                                A 公司 (行銷部) 和 B 公司 (財務部) 租在不同樓層。他們擁有自己的門禁卡、內部分機表 (IP Routing Table) 和辦公設備 (SLB VIPs)。A 公司的員工看不到 B 公司的機密文件，彼此完全隔離。
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 2. 運作原理 -->
        <div class="section-card">
            <div class="section-header">
                <i class="fas fa-cogs concept-icon text-2xl mr-3"></i>
                <h3 class="text-xl font-bold">二、運作原理 (Mechanism)</h3>
            </div>
            <div class="p-8">
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-a10blue font-bold text-lg mb-4 border-b pb-2">技術細節</h4>
                        <ul class="space-y-4 text-gray-700">
                            <li>
                                <strong>1. 層級架構 (Hierarchy)：</strong>
                                <br>所有配置分為 Global (全域) 與 Local (分區)。物理資源 (Interface, VLAN trunk) 屬於 Global/Shared；邏輯資源 (VIP, NAT Pool, aFleX) 屬於 Local Partition。
                            </li>
                            <li>
                                <strong>2. 封包流向 (Packet Flow)：</strong>
                                <br>當封包進入實體介面時，系統根據 <span class="highlight-text">VLAN ID</span> 或 <span class="highlight-text">MAC Address</span> 判斷該封包屬於哪個 Partition，然後將其「轉發」到該虛擬環境中處理。
                            </li>
                            <li>
                                <strong>3. 路由隔離 (Route Isolation)：</strong>
                                <br>每個 Partition 擁有獨立的 VRF (Virtual Routing and Forwarding)。這意味著 Partition A 和 Partition B 可以使用完全相同的 Private IP (例如 192.168.1.100) 而不會發生衝突。
                            </li>
                        </ul>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h4 class="text-a10blue font-bold text-lg mb-4 border-b pb-2">資源隔離與權限</h4>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <i class="fas fa-lock text-a10magenta mr-3"></i>
                                <span><strong>管理權限：</strong>Admin 可被限制只能登入特定的 Partition，無法看到其他分區設定。</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-memory text-a10magenta mr-3"></i>
                                <span><strong>資源配額 (Quotas)：</strong>可限制每個 Partition 能使用的 SSL Session 數、頻寬 (Bandwidth) 或連線數 (Concurrent Connections)。</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-network-wired text-a10magenta mr-3"></i>
                                <span><strong>關鍵參數：</strong><code>active-partition &lt;name&gt;</code> (切換分區指令)、<code>shared-partition</code> (預設管理區)。</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. 架構視覺化 -->
        <div class="section-card">
            <div class="section-header">
                <i class="fas fa-project-diagram concept-icon text-2xl mr-3"></i>
                <h3 class="text-xl font-bold">三、架構視覺化 (Visuals)</h3>
            </div>
            <div class="p-8">
                <p class="text-sm text-gray-500 mb-4 text-center">圖 1: A10 ADP 邏輯架構示意圖</p>
                <!-- 修正重點：移除巢狀子圖，改為平鋪式結構，保證渲染穩定性 -->
                <div class="mermaid mb-8">
                    graph TD
                    
                    %% 實體層定義
                    subgraph Hardware [實體層 Hardware Layer]
                        P1[Port 1]
                        P2[Port 2]
                        SW[ASIC / Switch Fabric]
                    end

                    %% 共享層定義
                    subgraph Shared [Shared Partition 管理層]
                        L1[L1/L2 Config]
                        VLAN[VLAN / Trunk]
                        System[System Resources]
                    end

                    %% 分區 A 定義
                    subgraph PartA [Partition A - Finance]
                        R1[Routing Table A]
                        SLB1[VIPs 10.1.1.x]
                        User1[Admin: Bob]
                    end

                    %% 分區 B 定義
                    subgraph PartB [Partition B - Marketing]
                        R2[Routing Table B]
                        SLB2[VIPs 192.168.1.x]
                        User2[Admin: Alice]
                    end

                    %% 連線關係
                    P1 --- SW
                    P2 --- SW
                    SW ==> L1
                    L1 --- VLAN
                    VLAN --- System
                    
                    %% 資源分配連線 (虛線)
                    System -.- |Resource Allocation| R1
                    System -.- |Resource Allocation| R2

                    %% 樣式設定
                    style Hardware fill:#002758,stroke:#333,stroke-width:2px,color:#fff
                    style Shared fill:#F58220,stroke:#333,stroke-width:2px,color:#fff
                    style PartA fill:#fff,stroke:#C60C30,stroke-width:2px
                    style PartB fill:#fff,stroke:#C60C30,stroke-width:2px
                    style SW fill:#333,color:#fff
                </div>

                <div class="border-t my-6"></div>

                <p class="text-sm text-gray-500 mb-4 text-center">圖 2: 封包處理流程 (Sequence Diagram)</p>
                <div class="mermaid">
                    sequenceDiagram
                        participant Client
                        participant Phy as 實體介面
                        participant Shared as Shared Partition
                        participant Private as Private Partition
                        participant Server as Real Server

                        Client->>Phy: 1. 發送請求 (Tag: VLAN 100)
                        Phy->>Shared: 2. L2 解析 (Match VLAN)
                        Note over Shared: 查找 VLAN 100 屬於哪個 Partition
                        Shared->>Private: 3. Context Switch (切換環境)
                        Note over Private: 獨立的 L3 路由表 & SLB 策略
                        Private->>Server: 4. 轉送至後端 (Source NAT)
                        Server-->>Private: 5. 回應封包
                        Private-->>Shared: 6. 封裝回傳
                        Shared-->>Client: 7. 回應 Client
                </div>
            </div>
        </div>

        <!-- 4. 實務應用場景 -->
        <div class="section-card">
            <div class="section-header">
                <i class="fas fa-briefcase concept-icon text-2xl mr-3"></i>
                <h3 class="text-xl font-bold">四、實務應用場景 (Use Case)</h3>
            </div>
            <div class="p-8">
                <div class="mb-6">
                    <h4 class="text-lg font-bold mb-2 text-a10blue">案例：金控集團的網段隔離</h4>
                    <p class="text-gray-700">
                        某大型金控集團擁有一台高效能的 Thunder 5430，需要同時服務「網路銀行 (Internet)」與「內部人資系統 (Intranet)」。
                    </p>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded border border-blue-100">
                            <strong class="text-a10blue">Partition 1: Internet-Banking</strong>
                            <p class="text-sm text-gray-600 mt-1">
                                面向公眾，需要極高的並發連線數 (Concurrent) 與 DDoS 防護。配置高優先級的 CPU 資源。
                            </p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded border border-purple-100">
                            <strong class="text-purple-900">Partition 2: Internal-HR</strong>
                            <p class="text-sm text-gray-600 mt-1">
                                僅限內網存取，流量較小。IP 網段可能與外部衝突 (Overlapping IP)，但在 L3V 中完全不受影響。
                            </p>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6 mt-6">
                    <div>
                        <h5 class="font-bold text-green-600 mb-2"><i class="fas fa-check-circle mr-2"></i>優點 (Pros)</h5>
                        <ul class="list-disc list-inside text-gray-700 text-sm space-y-1">
                            <li><strong>成本節省 (CapEx)：</strong>不需要買兩台硬體設備，省電費、機櫃空間。</li>
                            <li><strong>安全性高：</strong>HR 系統管理員無法誤觸或讀取網銀的配置。</li>
                            <li><strong>彈性擴充：</strong>若網銀流量暴增，可動態調配閒置資源給它。</li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-bold text-red-500 mb-2"><i class="fas fa-times-circle mr-2"></i>缺點 (Cons)</h5>
                        <ul class="list-disc list-inside text-gray-700 text-sm space-y-1">
                            <li><strong>單點故障風險：</strong>若實體硬體故障 (Power/Fan)，所有分區同時停擺 (需搭配 HA 規劃)。</li>
                            <li><strong>資源競爭：</strong>若未設定 Quota，某分區遭受攻擊可能耗盡系統 CPU。</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. 隨堂測驗 -->
        <div class="section-card">
            <div class="section-header">
                <i class="fas fa-question-circle concept-icon text-2xl mr-3"></i>
                <h3 class="text-xl font-bold">五、隨堂測驗 (Quiz)</h3>
            </div>
            <div class="p-8">
                <div id="quiz-container" class="space-y-6">
                    <!-- Quiz items will be injected here by JS -->
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-a10blue text-white py-6 mt-10">
        <div class="container mx-auto px-6 text-center">
            <p class="text-sm opacity-80 font-light tracking-wider">
                Planning & Design by Timmy(timmyc@hauman.com.tw) | 豪勉科技 Hauman Technologies Corporation | Ver 1.0
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'neutral',
            securityLevel: 'loose'
        });

        // Quiz Data
        const quizData = [
            {
                question: "1. 在 ACOS 系統中，掌管實體介面 (Interface) 與 VLAN 等 L1/L2 設定的是哪一個分區？",
                options: ["Private Partition", "Shared Partition", "L3V Partition", "User Partition"],
                correct: 1,
                explanation: "Shared Partition (共享分區) 就像大樓管理員，負責管理底層的實體網路資源與全域設定。"
            },
            {
                question: "2. 關於 L3V (ADP) 的特性，下列何者「錯誤」？",
                options: ["每個 Partition 擁有獨立的路由表", "不同 Partition 之間可以使用相同的 IP 網段", "所有 Partition 共用同一個管理者帳號與密碼", "可以限制每個 Partition 的資源使用量"],
                correct: 2,
                explanation: "L3V 的核心目的就是權限隔離。每個 Partition 可以擁有自己獨立的 Admin User，彼此互不干涉。"
            },
            {
                question: "3. 若要在 CLI 介面中切換到名為 'Marketing' 的分區，應使用什麼指令？",
                options: ["change partition Marketing", "active-partition Marketing", "switch-context Marketing", "goto Marketing"],
                correct: 1,
                explanation: "標準指令為 `active-partition <name>`。若要回到共享分區，通常使用 `shared-partition` 或 `active-partition shared`。"
            },
            {
                question: "4. 下列哪一個應用場景最「不適合」單純使用 L3V 技術解決？",
                options: ["將測試環境與生產環境隔離", "託管服務商 (MSP) 租賃給多個客戶", "兩台實體設備做異地備援 (Disaster Recovery)", "公司內部 HR 與 Guest 網路隔離"],
                correct: 2,
                explanation: "L3V 是「單機」虛擬化技術。異地備援 (DR) 需要兩台不同的實體設備配合 GSLB 或 VRRP-A，單靠 L3V 無法防止硬體毀損風險。"
            },
            {
                question: "5. 在 L3V 架構中，關於資源隔離 (Resource Isolation) 的敘述何者正確？",
                options: ["CPU 資源永遠是平均分配，無法調整", "只能隔離網路流量，無法隔離 SSL Session 數量", "透過 Template 或是 Profile 可以設定固定或彈性的資源配額", "所有分區共享所有 SSL 憑證，無法分開存儲"],
                correct: 2,
                explanation: "管理者可以配置資源範本 (Resource Template)，設定每個 Partition 的 SSL 連線數、吞吐量上限，支持固定配額或動態借用。"
            }
        ];

        // Render Quiz
        const quizContainer = document.getElementById('quiz-container');

        quizData.forEach((item, index) => {
            const qDiv = document.createElement('div');
            qDiv.className = 'border-b border-gray-200 pb-6 last:border-0';
            
            let optionsHtml = '';
            item.options.forEach((opt, optIndex) => {
                optionsHtml += `
                    <button onclick="checkAnswer(${index}, ${optIndex})" 
                        id="q${index}-opt${optIndex}"
                        class="quiz-option w-full text-left p-3 rounded border border-gray-300 mb-2 text-sm text-gray-700 hover:bg-blue-50">
                        ${String.fromCharCode(65 + optIndex)}. ${opt}
                    </button>
                `;
            });

            qDiv.innerHTML = `
                <p class="font-bold text-gray-800 mb-3">${item.question}</p>
                <div class="space-y-2">
                    ${optionsHtml}
                </div>
                <div id="q${index}-feedback" class="hidden mt-3 p-3 rounded text-sm"></div>
            `;
            quizContainer.appendChild(qDiv);
        });

        // Quiz Logic
        function checkAnswer(qIndex, optIndex) {
            const question = quizData[qIndex];
            const feedbackDiv = document.getElementById(`q${qIndex}-feedback`);
            
            // Disable buttons
            for(let i=0; i<4; i++) {
                const btn = document.getElementById(`q${qIndex}-opt${i}`);
                btn.disabled = true;
                if(i === question.correct) {
                    btn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                    btn.innerHTML += ' <i class="fas fa-check float-right mt-1"></i>';
                } else if (i === optIndex && i !== question.correct) {
                    btn.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
                    btn.innerHTML += ' <i class="fas fa-times float-right mt-1"></i>';
                } else {
                    btn.classList.add('opacity-50');
                }
            }

            // Show explanation
            feedbackDiv.classList.remove('hidden');
            if(optIndex === question.correct) {
                feedbackDiv.classList.add('bg-green-50', 'text-green-800', 'border', 'border-green-200');
                feedbackDiv.innerHTML = `<strong><i class="fas fa-check-circle"></i> 正確！</strong><br>${question.explanation}`;
            } else {
                feedbackDiv.classList.add('bg-red-50', 'text-red-800', 'border', 'border-red-200');
                feedbackDiv.innerHTML = `<strong><i class="fas fa-times-circle"></i> 答錯了。</strong><br>${question.explanation}`;
            }
        }
    </script>
</body>
</html>