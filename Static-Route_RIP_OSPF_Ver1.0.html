<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>網路架構教學：靜態路由與動態協定 (RIP/OSPF)</title>
    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Mermaid for Diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
        }
        .tab-btn.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            border-bottom: 2px solid #312e81;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        .concept-card {
            transition: transform 0.2s;
        }
        .concept-card:hover {
            transform: translateY(-2px);
        }
        .quiz-answer {
            display: none;
            background-color: #ecfdf5;
            border-left: 4px solid #10b981;
            padding: 1rem;
            margin-top: 0.5rem;
            border-radius: 0.25rem;
        }
        .quiz-answer.show {
            display: block;
        }
        .code-block {
            background-color: #1e293b;
            color: #a5b4fc;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.9em;
        }
        .terminal-window {
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            overflow-x: auto;
            border: 1px solid #333;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .terminal-header {
            color: #4ec9b0;
            font-weight: bold;
            border-bottom: 1px solid #333;
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .cmd-prompt { color: #569cd6; }
        .highlight-row { background-color: rgba(255, 255, 0, 0.1); }
        .highlight-cost { color: #facc15; font-weight: bold; text-decoration: underline; }
        /* Table Styles for Area Types */
        .area-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        .area-table th, .area-table td { border: 1px solid #e5e7eb; padding: 8px; text-align: center; }
        .area-table th { background-color: #e0e7ff; color: #3730a3; }
        .bg-allow { background-color: #d1fae5; color: #065f46; font-weight: bold; }
        .bg-block { background-color: #fee2e2; color: #991b1b; font-weight: bold; }
        .bg-special { background-color: #fef3c7; color: #92400e; font-weight: bold; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-slate-800 text-white p-6 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center space-x-4">
                <div class="p-3 bg-indigo-500 rounded-full">
                    <i class="fa-solid fa-network-wired text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold">網路架構教學模組</h1>
                    <p class="text-slate-300 mt-1">ExtremeXOS 網路架構大師 | 20 年實戰經驗傳承</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto w-full p-6">
        
        <!-- Tabs -->
        <div class="flex space-x-2 mb-8 border-b border-gray-300 overflow-x-auto">
            <button onclick="switchTab('static')" id="btn-static" class="tab-btn active px-6 py-3 font-semibold text-lg text-gray-600 rounded-t-lg hover:bg-indigo-50 transition-colors focus:outline-none whitespace-nowrap">
                <i class="fa-solid fa-map-pin mr-2"></i>靜態路由
            </button>
            <button onclick="switchTab('rip')" id="btn-rip" class="tab-btn px-6 py-3 font-semibold text-lg text-gray-600 rounded-t-lg hover:bg-indigo-50 transition-colors focus:outline-none whitespace-nowrap">
                <i class="fa-solid fa-bullhorn mr-2"></i>RIP
            </button>
            <button onclick="switchTab('ospf')" id="btn-ospf" class="tab-btn px-6 py-3 font-semibold text-lg text-gray-600 rounded-t-lg hover:bg-indigo-50 transition-colors focus:outline-none whitespace-nowrap">
                <i class="fa-solid fa-route mr-2"></i>OSPF 基礎
            </button>
            <button onclick="switchTab('ospf_area')" id="btn-ospf_area" class="tab-btn px-6 py-3 font-semibold text-lg text-gray-600 rounded-t-lg hover:bg-indigo-50 transition-colors focus:outline-none whitespace-nowrap">
                <i class="fa-solid fa-sitemap mr-2"></i>OSPF 進階 (Stub/NSSA)
            </button>
        </div>

        <!-- Content Area -->
        <div id="content-area">
            <!-- Content will be injected here by JS -->
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-400 py-6 mt-10 text-center text-sm border-t-4 border-indigo-500">
        <p>Planning & Design by Timmy(timmyc@hauman.com.tw) | 豪勉科技 Hauman Technologies Corporation | Ver 1.0</p>
    </footer>

    <!-- JavaScript Templates & Logic -->
    <script>
        // Data Objects for Content
        const contentData = {
            static: {
                title: "靜態路由 (Static Routing)",
                concept: {
                    definition: "網管人員手動指定封包前往特定目的地的路徑，這條路徑是固定不變的。",
                    analogy: "就像**公車路線**。公車司機（路由器）不會自己決定怎麼走，而是完全依照公司（網管人員）排定的路線表行駛。不管路上塞不塞車，它都走同一條路。"
                },
                mechanism: {
                    details: [
                        "<strong>封包流向：</strong>路由器查表 -> 比對目的地 IP -> 依據手動設定的 Next Hop (下一跳) 轉送。",
                        "<strong>控制層面：</strong>沒有任何協定封包交換，完全依賴管理員輸入。",
                        "<strong>ExtremeXOS 指令：</strong><span class='code-block'>configure iproute add [目的地網段] [遮罩] [下一跳IP]</span>",
                        "<strong>關鍵參數 - Administrative Distance (AD)：</strong>靜態路由的 AD 值通常預設為 1 (ExtremeXOS 預設 Gateway 也是優先)，代表可信度極高。"
                    ]
                },
                diagram: `graph LR
    subgraph HQ [總公司 HQ]
    R1[Core Router]
    end
    subgraph Branch [分公司 Branch]
    R2[Edge Router]
    end
    
    PC1[PC 192.168.1.10] --> R1
    R1 -- "Static Route: 192.168.2.0/24 -> 10.0.0.2" --> R2
    R2 -- "Connected" --> PC2[PC 192.168.2.10]
    
    style R1 fill:#f9f,stroke:#333,stroke-width:2px
    style R2 fill:#bbf,stroke:#333,stroke-width:2px`,
                useCase: {
                    scenario: "小型企業或末端辦公室 (Stub Network)。",
                    desc: "例如一家只有單一出口連接 ISP 的分公司。無論要去 Google、總公司還是 AWS，都只有這條路可走，設定一條 `Default Route (0.0.0.0/0)` 指向 ISP 即可。",
                    pros: "不占用 CPU 運算資源、安全（不會廣播路由表）、頻寬占用零。",
                    cons: "維護困難（網路一變動，所有人都要手動改）、缺乏容錯機制（路斷了不會自動切換）。"
                },
                quiz: [
                    { q: "靜態路由的主要缺點是什麼？", options: ["占用太多 CPU", "路徑斷線無法自動切換", "設定太複雜", "安全性低"], ans: 1, exp: "靜態路由是「寫死」的，若線路中斷，路由器不會自動尋找替代路徑。" },
                    { q: "在 ExtremeXOS 中，若要設定預設路由指向 192.168.1.254，指令為何？", options: ["ip route 0.0.0.0 0.0.0.0 192.168.1.254", "configure iproute add default 192.168.1.254", "set route default 192.168.1.254", "router static 0.0.0.0 192.168.1.254"], ans: 1, exp: "ExtremeXOS 的標準語法為 `configure iproute add default [gateway]`。" },
                    { q: "相比於 RIP 或 OSPF，靜態路由的 Administrative Distance (AD) 通常？", options: ["較高 (可信度低)", "較低 (可信度高)", "相同", "隨機"], ans: 1, exp: "AD 值越低代表越可信。Static 預設通常為 1，優於 OSPF (110) 和 RIP (120)。" },
                    { q: "適合使用靜態路由的場景是？", options: ["大型跨國 ISP", "擁有 500 台路由器的園區", "單一出口的末端網路 (Stub Network)", "經常變動拓撲的實驗室"], ans: 2, exp: "Stub Network 只有一條路出去，不需要複雜的動態協定運算。" },
                    { q: "如果我有兩條靜態路由指向同一目的地，但希望其中一條當備援 (Floating Static Route)，該怎麼做？", options: ["設定相同的 Metric", "設定不同的 Next Hop", "設定較高的 Metric/Preference", "無法做到"], ans: 2, exp: "透過調高備援路由的 Metric (Preference)，只有當主路由失效時，這條備援路由才會浮現到路由表中。" }
                ]
            },
            rip: {
                title: "RIP (Routing Information Protocol)",
                concept: {
                    definition: "一種基於距離向量 (Distance Vector) 的古老協定，依靠「跳數 (Hop Count)」來決定路徑好壞。",
                    analogy: "像是**鄰居傳話 (八卦)**。你問鄰居：「去市場怎麼走？」鄰居說：「經過我家，再過 2 個路口。」你不知道確切地圖，只知道聽鄰居的，而且每 30 秒大家會重新大喊一次八卦來更新資訊。"
                },
                mechanism: {
                    details: [
                        "<strong>運作原理：</strong>每隔 30 秒廣播整張路由表給相鄰路由器。",
                        "<strong>度量標準 (Metric)：</strong>Hop Count (跳數)。最大 15 跳，16 跳視為無法到達 (Infinite)。",
                        "<strong>防迴圈機制：</strong>Split Horizon (水平分割)、Route Poisoning (路由毒殺)。",
                        "<strong>ExtremeXOS 設定：</strong><span class='code-block'>configure rip add vlan [vlan_name]</span> (啟用該介面參與 RIP)。"
                    ]
                },
                diagram: `sequenceDiagram
    participant R1 as Router A
    participant R2 as Router B
    Note over R1, R2: 每 30 秒週期性更新
    R1->>R2: 發送完整路由表 (Response)
    R2->>R1: 發送完整路由表 (Response)
    Note over R1: R1 計算: 到 C 網段經過 R2 (1 Hop)
    Note over R2: R2 計算: 到 A 網段經過 R1 (1 Hop)
    loop 若線路中斷
        R1->>R2: 觸發更新 (Triggered Update): 網段 X Unreachable (Hop=16)
    end`,
                useCase: {
                    scenario: "極小型、舊式設備混合的網路環境。",
                    desc: "某些老舊的工控設備僅支援 RIP。或者在不需要複雜設定的小型封閉網路中快速佈署。",
                    pros: "設定極度簡單（幾乎隨插即用）、硬體資源需求極低。",
                    cons: "收斂速度慢 (Convergence Slow)、最大直徑僅限 15 跳、廣播封包消耗頻寬、不考慮頻寬速度 (10M 線路與 10G 線路對 RIP 來說是一樣的，只要跳數相同)。"
                },
                quiz: [
                    { q: "RIP 使用什麼作為衡量路徑好壞的標準？", options: ["頻寬 (Bandwidth)", "延遲 (Delay)", "跳數 (Hop Count)", "負載 (Load)"], ans: 2, exp: "RIP 唯一的 Metric 就是 Hop Count，這也是它最大的限制。" },
                    { q: "RIP 認為一個網路「不可達」的跳數是多少？", options: ["10", "15", "16", "255"], ans: 2, exp: "15 跳是極限，16 跳在 RIP 中定義為無限大 (Infinity/Unreachable)。" },
                    { q: "RIPv1 和 RIPv2 的主要差異是什麼？", options: ["最大跳數不同", "v2 支援 VLSM (變長子網路遮罩) 與組播更新", "v1 比較快", "v2 支援 100 跳"], ans: 1, exp: "RIPv1 是有類別 (Classful) 路由，不傳送遮罩；RIPv2 支援 VLSM 並使用 Multicast (224.0.0.9) 更新，效率較好。" },
                    { q: "防止 RIP 路由迴圈的機制之一「水平分割 (Split Horizon)」是指？", options: ["把網路切成兩半", "不將從某介面學到的路由再回傳給該介面", "每 15 秒更新一次", "限制最大跳數為 5"], ans: 1, exp: "Split Horizon 的原則是：不要把從鄰居聽來的消息，再告訴那位鄰居。" },
                    { q: "為何現代大型企業網少用 RIP？", options: ["收斂太慢且無法依頻寬選路", "設定太難", "授權費太貴", "不支援 IPv4"], ans: 0, exp: "RIP 收斂慢容易造成路由黑洞，且走 56K 數據機跟走 10G 光纖對 RIP 來說只要跳數一樣就好壞一樣，這不符合現代需求。" }
                ]
            },
            ospf: {
                title: "OSPF 基礎與運作 (Basic)",
                concept: {
                    definition: "基於鏈路狀態 (Link-State) 的協定。路由器彼此交換地圖資訊，各自計算出最短路徑。",
                    analogy: "就像 **Google Maps / 導航系統**。每台車（路由器）都下載了完整的地圖資料庫。當某條路塞車（Link Down/Cost 變高），所有人的導航會立刻重新計算出一條新的最佳路徑，而不是聽信路人。"
                },
                mechanism: {
                    details: [
                        "<strong>運作原理：</strong>發送 LSA (Link State Advertisement) 建立 LSDB (資料庫)，使用 Dijkstra (SPF) 演算法計算最短路徑樹。",
                        "<strong>鄰居建立狀態 (Neighbor States)：</strong><ul class='list-decimal pl-5 mt-2 space-y-1 text-sm text-gray-700'><li><strong>Down:</strong> 初始狀態，未收到 Hello。</li><li><strong>Init:</strong> 收到 Hello，但對方名單無我。</li><li><strong>2-Way:</strong> 雙向確認 (DR/BDR 選舉)。</li><li><strong>ExStart/Exchange:</strong> 交換 LSDB 摘要 (DBD)。</li><li><strong>Loading:</strong> 更新詳細 LSA。</li><li class='bg-red-50 p-1 rounded border-l-4 border-red-500'><strong>Full (完全鄰接):</strong> <span class='text-red-600 font-bold'>關鍵狀態！</span>代表 LSDB 已完全同步。只有達到 Full，路由器才會將此路徑納入路由計算。</li></ul>",
                        "<strong>度量標準 (Cost) 計算與陷阱：</strong><br>公式：<code>Cost = Reference Bandwidth / Interface Bandwidth</code><br><br><div class='bg-yellow-50 p-3 rounded border border-yellow-200 text-sm'><p class='font-bold text-yellow-800 mb-1'><i class='fa-solid fa-triangle-exclamation'></i> 實務陷阱：預設參考頻寬通常為 100Mbps</p><table class='w-full text-left border-collapse'><thead><tr class='border-b border-yellow-300'><th class='py-1'>介面速度</th><th class='py-1'>預設 Cost (Ref=100M)</th><th class='py-1'>修正後 Cost (Ref=40G)</th></tr></thead><tbody><tr class='border-b border-yellow-100'><td class='py-1'>100 Mbps</td><td class='py-1'>1 (100/100)</td><td class='py-1'>400</td></tr><tr class='border-b border-yellow-100'><td class='py-1'>1 Gbps</td><td class='py-1 text-red-500 font-bold'>1 (100/1000 = 0.1 -> 1)</td><td class='py-1 text-green-600 font-bold'>40 (40000/1000)</td></tr><tr><td class='py-1'>10 Gbps</td><td class='py-1 text-red-500 font-bold'>1 (100/10000 = 0.01 -> 1)</td><td class='py-1 text-green-600 font-bold'>4 (40000/10000)</td></tr></tbody></table><p class='mt-2 text-gray-700'><strong>結論：</strong>若不修改參考頻寬，OSPF 會認為 1G 與 10G 是一樣快的 (Cost 都是 1)，導致無法正確選路！</p><p class='mt-2'><strong>ExtremeXOS 修正指令：</strong><br><span class='code-block'>configure ospf reference-bandwidth 40000</span> (單位通常為 Mbps，依版本而定)</p></div>",
                        "<strong>ExtremeXOS 路由表實戰解析 (show iproute)：</strong><br>在 CLI 中，Cost 通常顯示在 Metric 欄位。以下為修改參考頻寬後的範例：<div class='terminal-window'><div class='terminal-header'>ExtremeXOS - Telnet</div><div class='font-mono text-sm'><span class='cmd-prompt'>X460-G2 #</span> show iproute<br><br>Destination      Gateway       Flags    <span class='highlight-cost'>Metric</span>   Interface<br>----------------------------------------------------------------<br><span class='highlight-row'>192.168.10.0/24  10.10.10.2    UG-D---  <span class='highlight-cost'>40</span>       vlan_1g_link</span>  <span class='text-gray-500'># Cost 40 (1G 介面)</span><br><span class='highlight-row'>192.168.20.0/24  10.20.20.2    UG-D---  <span class='highlight-cost'>4</span>        vlan_10g_link</span> <span class='text-gray-500'># Cost 4  (10G 介面)</span><br>10.0.0.0/24      10.0.0.1      U------  1        vlan_mgmt<br><br><span class='text-gray-400'>Flags: (U) Up, (G) Gateway, (D) Dynamic (OSPF)</span></div></div>",
                        "<strong>ExtremeXOS 設定：</strong><span class='code-block'>configure ospf add vlan [vlan] area 0.0.0.0</span>"
                    ]
                },
                diagram: `graph TD
    subgraph Area0 [Backbone Area 0]
    R1((Core SW 1))
    R2((Core SW 2))
    R1 --- R2
    end
    
    subgraph Area1 [User Area 1]
    R3[Access SW A]
    R4[Access SW B]
    R3 --- R1
    R4 --- R1
    end
    
    subgraph Area2 [Server Area 2]
    R5[Server SW]
    R5 --- R2
    end
    
    classDef backbone fill:#f96,stroke:#333,stroke-width:2px;
    class R1,R2 backbone;`,
                useCase: {
                    scenario: "中大型企業園區網路、資料中心。",
                    desc: "企業內部有核心層、匯聚層、存取層，線路頻寬不一 (1G/10G/40G)。OSPF 能準確選擇 40G 的路徑而不是 1G 的捷徑。",
                    pros: "收斂速度極快、支援無類別路由 (VLSM)、以頻寬選路 (Cost)、階層式設計 (Area) 易於擴展。",
                    cons: "消耗 CPU 與記憶體較多 (需維護 LSDB)、設定與除錯較複雜。"
                },
                quiz: [
                    { q: "OSPF 網路中，所有區域都必須連接到哪一個區域？", options: ["Area 1", "Area 100", "Area 0 (Backbone)", "任意區域皆可"], ans: 2, exp: "OSPF 採用雙層次結構，所有非骨幹區域必須透過 Area 0 交換資訊以防環路。" },
                    { q: "在預設 Reference Bandwidth (100Mbps) 下，1G 與 10G 介面的 Cost 分別是多少？", options: ["10 與 1", "100 與 10", "1 與 1", "1000 與 100"], ans: 2, exp: "因 100/1000 與 100/10000 都小於 1，OSPF 最低 Cost 為 1，導致兩者無法區分。需調整 reference-bandwidth。" },
                    { q: "在廣播型網路 (如 Ethernet) 中，OSPF 會選舉哪兩個角色來減少 LSA 泛洪？", options: ["Master / Slave", "Active / Standby", "DR (Designated Router) / BDR", "Root / Leaf"], ans: 2, exp: "DR 與 BDR 負責收集並分發 LSA，避免所有路由器兩兩互傳造成流量爆炸。" },
                    { q: "若要在 ExtremeXOS 查看 OSPF 鄰居狀態，指令通常是？", options: ["show ip ospf neighbor", "show ospf neighbor", "display ospf peer", "view ospf neighbors"], ans: 1, exp: "ExtremeXOS 的標準指令為 `show ospf neighbor`。" },
                    { q: "OSPF 鄰居狀態必須達到什麼狀態，才代表 LSDB 完全同步且路由可正常運作？", options: ["2-Way", "Exchange", "Full", "Loading"], ans: 2, exp: "「Full」狀態代表雙方資料庫已完全一致。若僅停留在 2-Way (DROther 之間) 或 ExStart (MTU 問題)，則尚未完成路由交換。" }
                ]
            },
            ospf_area: {
                title: "OSPF 進階：區域類型 (Area Types)",
                concept: {
                    definition: "為了減少大型網路的路由表與 LSA 泛洪，OSPF 定義了特殊區域來過濾不必要的外部資訊。",
                    analogy: "<strong>Stub (末梢區域)</strong> 像是「死胡同」，只有一個出口，不需要詳細地圖，只要知道「往外走」就好。<br><strong>NSSA (非完全末梢區域)</strong> 像是「有後門的死胡同」，雖然不收外面的垃圾信件 (External LSA)，但可以從自家後門 (Local External) 送貨出去。"
                },
                mechanism: {
                    details: [
                        "<strong>為什麼需要特殊區域？</strong> 當路由表過於龐大，末端設備 (如分公司路由器) CPU/RAM 不足時，我們透過過濾 LSA Type 來減輕負擔。",
                        "<strong>Stub 與 NSSA 的核心差異 (LSA Filtering)：</strong><table class='area-table'><thead><tr><th>LSA Type</th><th>標準區域 (Standard)</th><th>Stub Area (末梢)</th><th>Totally Stub (完全末梢)</th><th>NSSA</th></tr></thead><tbody><tr><td>Type 1 & 2 (Intra-area)</td><td class='bg-allow'>允許</td><td class='bg-allow'>允許</td><td class='bg-allow'>允許</td><td class='bg-allow'>允許</td></tr><tr><td>Type 3 (Inter-area)</td><td class='bg-allow'>允許</td><td class='bg-allow'>允許</td><td class='bg-block'>阻擋 (僅 Default)</td><td class='bg-allow'>允許</td></tr><tr><td>Type 4 & 5 (External)</td><td class='bg-allow'>允許</td><td class='bg-block'>阻擋</td><td class='bg-block'>阻擋</td><td class='bg-block'>阻擋</td></tr><tr><td>Type 7 (NSSA External)</td><td class='bg-block'>阻擋</td><td class='bg-block'>阻擋</td><td class='bg-block'>阻擋</td><td class='bg-special'>允許 (ABR 轉 Type 5)</td></tr></tbody></table>",
                        "<strong>NSSA 的特殊行為：</strong>NSSA 允許引入外部路由 (如重分發 RIP/Static)，這些路由以 <strong>Type 7 LSA</strong> 存在於 NSSA 內。當到達 ABR (區域邊界路由器) 時，ABR 會將其轉換為 <strong>Type 5 LSA</strong> 泛洪至骨幹區域。",
                        "<strong>ExtremeXOS 設定指令：</strong><br>Stub 設定：<span class='code-block'>configure ospf area 0.0.0.1 stub</span><br>NSSA 設定：<span class='code-block'>configure ospf area 0.0.0.2 nssa</span><br>完全末梢 (Totally Stub/NSSA) 通常透過 <span class='code-block'>no-summary</span> 選項或預設 summary 行為控制。"
                    ]
                },
                diagram: `graph TB
    subgraph Backbone ["Area 0 (Backbone)"]
    R1((Core R1))
    R2((Core R2))
    end

    subgraph Stub ["Area 1 (Stub)"]
    R3[Stub Router]
    note1[阻擋 Type 5 External<br>僅接受 Type 3 Summary<br>ABR 注入 Default Route]
    end

    subgraph NSSA ["Area 2 (NSSA)"]
    R4[NSSA ABR]
    R5[ASBR]
    ext[外部網路/4G]
    note2[阻擋骨幹來的 Type 5<br>允許本地引入 Type 7<br>ABR 將 Type 7 轉 Type 5]
    end
    
    R1 --- R3
    R2 --- R4
    R4 --- R5
    R5 -.->|Redistribute| ext
    
    R3 -.->|Block LSA 5| R1
    R5 == Type 7 ==> R4
    R4 == Type 5 ==> R2
    
    style Backbone fill:#fef3c7,stroke:#d97706,stroke-width:2px
    style Stub fill:#d1fae5,stroke:#059669,stroke-width:2px
    style NSSA fill:#e0e7ff,stroke:#4f46e5,stroke-width:2px`,
                useCase: {
                    scenario: "分公司網路設計選擇。",
                    desc: "<strong>Stub：</strong> 一般分公司，只有一條專線連回總部。不需要知道外部 Internet 的詳細路由，給它一條 Default Route 指向總部即可。<br><strong>NSSA：</strong> 分公司有一條主要的專線連總部，但同時有一條本地的 Internet 線路 (DSL/4G) 用於備援或供客用 WiFi 上網。我們需要把這條本地路由告訴總部，但不希望總部把幾萬條 Internet 路由灌爆分公司路由器。",
                    pros: "大幅減少路由表大小 (Memory) 與 SPF 計算負擔 (CPU)，提高網路穩定性。",
                    cons: "設定較複雜，所有該區域的路由器 (包含 ABR) 均需設定相同的 Area Type 旗標，否則鄰居無法建立 (Hello 封包中 Option bit 不符)。"
                },
                quiz: [
                    { q: "Stub 區域絕對不允許哪種 LSA 進入？", options: ["Type 1 (Router)", "Type 3 (Summary)", "Type 5 (External)", "Type 2 (Network)"], ans: 2, exp: "Stub 的定義就是為了過濾掉外部路由 (Type 5 LSA)。" },
                    { q: "NSSA 區域內產生的外部路由，會使用哪種 LSA 類型？", options: ["Type 1", "Type 3", "Type 5", "Type 7"], ans: 3, exp: "NSSA 專用的 LSA 是 Type 7，它在通過 ABR 進入骨幹時會被轉成 Type 5。" },
                    { q: "若要設定 Totally Stub Area (完全末梢)，除了 Type 5 之外，還額外阻擋了什麼？", options: ["Type 1", "Type 2", "Type 3 (Inter-area)", "Hello 封包"], ans: 2, exp: "Totally Stub 連其他區域的彙整路由 (Type 3) 都阻擋，只留一條 Default Route。" },
                    { q: "設定 Stub 或 NSSA 時，若鄰居路由器的設定不一致 (一邊是 Normal 一邊是 Stub)，會發生什麼事？", options: ["會自動協商", "鄰居關係卡在 Down 或 Init，無法建立", "可以建立鄰居但無法交換路由", "會變成 RIP 協定"], ans: 1, exp: "Hello 封包中的 Option 欄位會攜帶 E-bit (External Capability)，若雙方不匹配，鄰居關係無法建立。" },
                    { q: "哪種場景最適合使用 NSSA？", options: ["純粹的末端辦公室", "核心骨幹區域", "連接 ISP 且不希望接收全網路由的邊緣區域", "資料中心內部"], ans: 2, exp: "當你有本地外部連接 (如 ISP)，卻又不想接收來自骨幹的外部路由時，NSSA 是最佳解。" }
                ]
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            mermaid.initialize({ startOnLoad: true });
            switchTab('static');
        });

        function switchTab(tabId) {
            // Update Buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-indigo-500', 'text-indigo-600');
                btn.classList.add('text-gray-600');
            });
            const activeBtn = document.getElementById(`btn-${tabId}`);
            if(activeBtn) {
                activeBtn.classList.add('active', 'text-indigo-600');
                activeBtn.classList.remove('text-gray-600');
            }

            // Render Content
            renderContent(tabId);
        }

        function renderContent(key) {
            const data = contentData[key];
            const container = document.getElementById('content-area');
            
            // Build Mechanism List
            const mechanismHtml = data.mechanism.details.map(item => `<li class="mb-2 text-gray-700 pl-4 border-l-4 border-indigo-200">${item}</li>`).join('');

            // Build Quiz
            const quizHtml = data.quiz.map((q, index) => `
                <div class="mb-6 p-4 bg-white rounded shadow-sm border border-gray-100">
                    <p class="font-bold text-gray-800 mb-3"><span class="text-indigo-500 mr-2">Q${index+1}.</span>${q.q}</p>
                    <div class="space-y-2 mb-3">
                        ${q.options.map((opt, i) => `
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="q-${key}-${index}" value="${i}" class="form-radio text-indigo-600">
                                <span class="text-gray-600">${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                    <button onclick="toggleAnswer('${key}-${index}')" class="text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1 rounded transition">
                        <i class="fa-regular fa-eye mr-1"></i>看答案與解析
                    </button>
                    <div id="ans-${key}-${index}" class="quiz-answer">
                        <p class="font-bold text-green-700">正確答案：${q.options[q.ans]}</p>
                        <p class="text-sm text-gray-600 mt-1">${q.exp}</p>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-fade-in">
                    
                    <!-- 核心概念 -->
                    <section class="bg-white p-6 rounded-lg shadow-md border-t-4 border-blue-500 concept-card">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fa-solid fa-lightbulb text-yellow-500 mr-2"></i>一、核心概念 (Concept)
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold text-gray-700">一句話定義：</h3>
                                <p class="text-gray-600 bg-gray-50 p-3 rounded">${data.concept.definition}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-700">生活化比喻：</h3>
                                <p class="text-gray-600 bg-blue-50 p-3 rounded italic border-l-4 border-blue-300">"${data.concept.analogy}"</p>
                            </div>
                        </div>
                    </section>

                    <!-- 運作原理 -->
                    <section class="bg-white p-6 rounded-lg shadow-md border-t-4 border-green-500 concept-card">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fa-solid fa-gears text-green-500 mr-2"></i>二、運作原理 (Mechanism)
                        </h2>
                        <ul class="list-none space-y-2">
                            ${mechanismHtml}
                        </ul>
                    </section>

                    <!-- 架構視覺化 -->
                    <section class="bg-white p-6 rounded-lg shadow-md border-t-4 border-purple-500 lg:col-span-2">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fa-solid fa-project-diagram text-purple-500 mr-2"></i>三、架構視覺化 (Visuals)
                        </h2>
                        <div class="mermaid overflow-x-auto">
                            ${data.diagram}
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-2">圖表：${data.title} 架構示意圖</p>
                    </section>

                    <!-- 實務應用場景 -->
                    <section class="bg-white p-6 rounded-lg shadow-md border-t-4 border-red-500 lg:col-span-2">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fa-solid fa-briefcase text-red-500 mr-2"></i>四、實務應用場景 (Use Case)
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h3 class="font-bold text-gray-700 mb-2">情境案例：</h3>
                                <p class="text-gray-600 mb-4">${data.useCase.scenario}</p>
                                <p class="text-gray-600 text-sm bg-gray-50 p-3 rounded">${data.useCase.desc}</p>
                            </div>
                            <div class="grid grid-rows-2 gap-2">
                                <div class="bg-green-50 p-3 rounded border border-green-100">
                                    <span class="font-bold text-green-700"><i class="fa-solid fa-thumbs-up mr-1"></i> 優點：</span>
                                    <span class="text-gray-700 text-sm">${data.useCase.pros}</span>
                                </div>
                                <div class="bg-red-50 p-3 rounded border border-red-100">
                                    <span class="font-bold text-red-700"><i class="fa-solid fa-thumbs-down mr-1"></i> 缺點：</span>
                                    <span class="text-gray-700 text-sm">${data.useCase.cons}</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 隨堂測驗 -->
                    <section class="bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200 lg:col-span-2">
                        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fa-solid fa-pen-to-square text-indigo-500 mr-2"></i>五、隨堂測驗 (Quiz)
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${quizHtml}
                        </div>
                    </section>

                </div>
            `;
            
            // Re-render Mermaid
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        }

        function toggleAnswer(id) {
            const el = document.getElementById(`ans-${id}`);
            if (el.classList.contains('show')) {
                el.classList.remove('show');
            } else {
                el.classList.add('show');
            }
        }
    </script>
</body>
</html>