<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>網站測速工具</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Inline SVG Components) ---
        const IconPlay = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"/></svg>
        );
        const IconRotateCcw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></svg>
        );
        const IconPlus = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        );
        const IconTrash2 = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
        );
        const IconGlobe = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        );
        const IconActivity = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
        );
        const IconWifiOff = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="1" x2="23" y1="1" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.58 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" x2="12.01" y1="20" y2="20"/></svg>
        );
        const IconBarChart3 = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
        );
        const IconAlertCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
        );
        const IconRefreshCw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );

        // --- Configuration & Helpers ---
        const TEST_ROUNDS = 5;

        const DEFAULT_SITES = [
            { id: 'google', name: 'Google', url: 'https://www.google.com', endpoint: 'https://www.google.com/favicon.ico' },
            { id: 'youtube', name: 'YouTube', url: 'https://www.youtube.com', endpoint: 'https://www.youtube.com/favicon.ico' },
            { id: 'facebook', name: 'Facebook', url: 'https://www.facebook.com', endpoint: 'https://www.facebook.com/favicon.ico' },
            { id: 'cht', name: '中華電信', url: 'https://www.cht.com.tw', endpoint: 'https://www.cht.com.tw/favicon.ico' },
            { id: 'taiwanmobile', name: '台灣大哥大', url: 'https://www.taiwanmobile.com', endpoint: 'https://www.taiwanmobile.com/favicon.ico' },
            { id: 'fetnet', name: '遠傳電信', url: 'https://www.fetnet.net', endpoint: 'https://www.fetnet.net/favicon.ico' },
            { id: 'ntu', name: '台灣大學', url: 'https://www.ntu.edu.tw', endpoint: 'https://www.ntu.edu.tw/favicon.ico' },
            { id: 'chihlee', name: '致理科大', url: 'https://www.chihlee.edu.tw', endpoint: 'https://www.chihlee.edu.tw/favicon.ico' },
            { id: 'au', name: '真理大學', url: 'https://www.au.edu.tw', endpoint: 'https://www.au.edu.tw/favicon.ico' },
            { id: 'cloudflare', name: 'Cloudflare (DNS)', url: 'https://1.1.1.1', endpoint: 'https://1.1.1.1/favicon.ico' },
            { id: 'github', name: 'GitHub', url: 'https://github.com', endpoint: 'https://github.com/favicon.ico' },
            { id: 'pchome', name: 'PChome 24h', url: 'https://24h.pchome.com.tw', endpoint: 'https://24h.pchome.com.tw/favicon.ico' },
            { id: 'yahoo_tw', name: 'Yahoo 奇摩', url: 'https://tw.yahoo.com', endpoint: 'https://tw.yahoo.com/favicon.ico' },
            { id: 'shopee', name: '蝦皮購物', url: 'https://shopee.tw', endpoint: 'https://shopee.tw/favicon.ico' },
            { id: 'gamer', name: '巴哈姆特', url: 'https://www.gamer.com.tw', endpoint: 'https://www.gamer.com.tw/favicon.ico' },
        ];

        const getLatencyColor = (ms) => {
            if (ms <= 0) return 'text-gray-400 bg-gray-100'; 
            if (ms < 100) return 'text-green-600 bg-green-100';
            if (ms < 300) return 'text-blue-600 bg-blue-100';
            if (ms < 800) return 'text-yellow-600 bg-yellow-100';
            return 'text-orange-600 bg-orange-100';
        };

        // --- Main Application ---
        function NetworkSpeedTest() {
            const [sites, setSites] = useState(DEFAULT_SITES);
            const [results, setResults] = useState({});
            const [isTesting, setIsTesting] = useState(false);
            const [currentRound, setCurrentRound] = useState(0);
            const [newUrl, setNewUrl] = useState('');
            const [newName, setNewName] = useState('');
            const [progress, setProgress] = useState(0);
            
            // UI States
            const [errorMsg, setErrorMsg] = useState('');
            const [resetConfirm, setResetConfirm] = useState(false);

            // Ping logic
            const pingSite = async (site) => {
                return new Promise((resolve) => {
                    const startTime = performance.now();
                    const img = new Image();
                    let completed = false;

                    const finish = (status) => {
                        if (completed) return;
                        completed = true;
                        const endTime = performance.now();
                        const duration = Math.round(endTime - startTime);
                        const isTimeout = status === 'timeout';
                        resolve({ 
                            id: site.id, 
                            latency: isTimeout ? -2 : duration, 
                            status: isTimeout ? 'timeout' : 'done' 
                        });
                    };

                    const timeoutId = setTimeout(() => {
                        if (!completed) {
                            completed = true;
                            resolve({ id: site.id, latency: -2, status: 'timeout' });
                        }
                    }, 3000);

                    const cacheBuster = `?t=${new Date().getTime()}`;
                    
                    img.onload = () => { clearTimeout(timeoutId); finish('success'); };
                    img.onerror = () => { clearTimeout(timeoutId); finish('error_response'); };
                    img.src = site.endpoint + cacheBuster;
                });
            };

            const runAllTests = async () => {
                if (isTesting) return;
                setIsTesting(true);
                setResults({});
                setProgress(0);
                setCurrentRound(0);
                
                const totalSteps = sites.length * TEST_ROUNDS;
                let completedSteps = 0;

                const initialResults = {};
                sites.forEach(site => {
                    initialResults[site.id] = { samples: [], loading: false, status: 'pending' };
                });
                setResults(initialResults);

                for (let round = 1; round <= TEST_ROUNDS; round++) {
                    setCurrentRound(round);
                    
                    for (const site of sites) {
                        setResults(prev => ({
                            ...prev,
                            [site.id]: { ...prev[site.id], loading: true }
                        }));

                        const result = await pingSite(site);

                        setResults(prev => {
                            const currentSamples = prev[site.id]?.samples || [];
                            return {
                                ...prev,
                                [site.id]: { 
                                    ...prev[site.id],
                                    samples: [...currentSamples, result.latency],
                                    loading: false,
                                    status: result.status
                                }
                            };
                        });

                        completedSteps++;
                        setProgress((completedSteps / totalSteps) * 100);
                        await new Promise(r => setTimeout(r, 50));
                    }
                }
                setIsTesting(false);
            };

            const handleAddSite = (e) => {
                e.preventDefault();
                setErrorMsg('');
                if (!newUrl) return;

                let url = newUrl.trim();
                if (!url.startsWith('http')) {
                    url = 'https://' + url;
                }

                try {
                    const urlObj = new URL(url);
                    const siteName = newName.trim() || urlObj.hostname;
                    const id = 'custom_' + Date.now();
                    const endpoint = `${urlObj.origin}/favicon.ico`;

                    const newSite = { id, name: siteName, url: urlObj.origin, endpoint };
                    setSites([...sites, newSite]);
                    setNewUrl('');
                    setNewName('');
                } catch (err) {
                    setErrorMsg('無效的網址格式，請檢查。');
                    setTimeout(() => setErrorMsg(''), 3000);
                }
            };

            const removeSite = (id) => {
                setSites(sites.filter(s => s.id !== id));
                const newResults = { ...results };
                delete newResults[id];
                setResults(newResults);
            };

            const handleReset = () => {
                if (resetConfirm) {
                    setSites(DEFAULT_SITES);
                    setResults({});
                    setProgress(0);
                    setCurrentRound(0);
                    setIsTesting(false);
                    setResetConfirm(false);
                } else {
                    setResetConfirm(true);
                    setTimeout(() => setResetConfirm(false), 3000); // Reset confirm state after 3s
                }
            };

            // Stats Helper
            const calculateStats = (samples = []) => {
                const validSamples = samples.filter(s => s > 0);
                const failSamples = samples.filter(s => s === -2);

                if (validSamples.length === 0) return { min: 0, max: 0, avg: 0, validCount: 0, failCount: failSamples.length };
                
                const min = Math.min(...validSamples);
                const max = Math.max(...validSamples);
                const sum = validSamples.reduce((a, b) => a + b, 0);
                const avg = Math.round(sum / validSamples.length);
                
                return { min, max, avg, validCount: validSamples.length, failCount: failSamples.length };
            };

            const allStats = sites.map(site => {
                const r = results[site.id];
                if (!r || r.samples.length === 0) return null;
                return calculateStats(r.samples);
            }).filter(Boolean);

            const globalAvg = allStats.length > 0 
                ? Math.round(allStats.reduce((acc, curr) => acc + curr.avg, 0) / allStats.length)
                : 0;

            const globalFastest = allStats.length > 0
                ? Math.min(...allStats.filter(s => s.validCount > 0).map(s => s.min))
                : 0;
            
            const totalCompletedSites = allStats.filter(s => s.validCount > 0).length;

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans p-4 md:p-8">
                    <div className="max-w-5xl mx-auto space-y-6">
                        
                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-sm p-6 flex flex-col md:flex-row items-center justify-between gap-4">
                            <div>
                                <h1 className="text-2xl font-bold text-gray-900 flex items-center gap-2">
                                    <IconActivity className="text-blue-600" />
                                    網站回應速度測試
                                </h1>
                                <p className="text-gray-500 text-sm mt-1">
                                    每站進行 {TEST_ROUNDS} 次循環測試，並計算平均值以求精確
                                </p>
                            </div>
                            <div className="flex gap-3">
                                <button 
                                    onClick={handleReset}
                                    disabled={isTesting}
                                    className={`px-4 py-3 rounded-xl border font-medium transition-all shadow-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed ${
                                        resetConfirm 
                                            ? 'bg-red-50 text-red-600 border-red-200 animate-pulse' 
                                            : 'text-gray-600 bg-white border-gray-200 hover:bg-gray-50 hover:text-blue-600'
                                    }`}
                                    title="重置回預設列表"
                                >
                                    <IconRefreshCw className={`w-4 h-4 ${resetConfirm ? 'rotate-180 transition-transform' : ''}`} />
                                    <span className="hidden sm:inline">{resetConfirm ? '確定重置?' : '重置列表'}</span>
                                </button>

                                <button 
                                    onClick={runAllTests}
                                    disabled={isTesting}
                                    className={`flex items-center gap-2 px-6 py-3 rounded-xl text-white font-medium transition-all min-w-[160px] justify-center ${
                                        isTesting 
                                        ? 'bg-gray-400 cursor-not-allowed' 
                                        : 'bg-blue-600 hover:bg-blue-700 shadow-lg hover:shadow-blue-200 active:scale-95'
                                    }`}
                                >
                                    {isTesting ? (
                                        <>
                                            <IconRotateCcw className="animate-spin w-5 h-5" />
                                            第 {currentRound}/{TEST_ROUNDS} 輪
                                        </>
                                    ) : (
                                        <>
                                            <IconPlay className="w-5 h-5 fill-current" />
                                            開始測試
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Progress Bar */}
                        {isTesting && (
                            <div className="w-full bg-gray-200 rounded-full h-1.5 overflow-hidden">
                                <div 
                                    className="bg-blue-500 h-full transition-all duration-300 ease-out"
                                    style={{ width: `${progress}%` }}
                                ></div>
                            </div>
                        )}

                        {/* Stats Summary */}
                        {allStats.length > 0 && (
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-4 fade-in">
                                <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-green-500">
                                    <div className="text-gray-500 text-xs uppercase font-bold tracking-wider">最佳單次回應</div>
                                    <div className="text-2xl font-bold text-gray-900 mt-1">{globalFastest} <span className="text-sm font-normal text-gray-500">ms</span></div>
                                </div>
                                <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-blue-500">
                                    <div className="text-gray-500 text-xs uppercase font-bold tracking-wider">總平均延遲</div>
                                    <div className="text-2xl font-bold text-gray-900 mt-1">{globalAvg} <span className="text-sm font-normal text-gray-500">ms</span></div>
                                </div>
                                <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-purple-500 col-span-2 md:col-span-1">
                                    <div className="text-gray-500 text-xs uppercase font-bold tracking-wider">有效連線網站</div>
                                    <div className="text-2xl font-bold text-gray-900 mt-1">
                                        {totalCompletedSites} <span className="text-gray-400 text-lg">/ {sites.length}</span>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Main List & Chart */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            
                            {/* List Section */}
                            <div className="lg:col-span-2 space-y-4">
                                <div className="bg-white rounded-2xl shadow-sm overflow-hidden">
                                    <div className="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                                        <h3 className="font-semibold text-gray-700 flex items-center gap-2">
                                            <IconGlobe className="w-4 h-4" />
                                            目標網站列表
                                        </h3>
                                        <span className="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded-full">
                                            5 次平均值
                                        </span>
                                    </div>

                                    <div className="divide-y divide-gray-100 max-h-[600px] overflow-y-auto">
                                        {sites.map((site) => {
                                            const result = results[site.id];
                                            const samples = result ? result.samples : [];
                                            const loading = result ? result.loading : false;
                                            const stats = calculateStats(samples);
                                            
                                            return (
                                                <div key={site.id} className="p-4 flex flex-col sm:flex-row sm:items-center justify-between hover:bg-gray-50 transition-colors gap-3">
                                                    <div className="flex items-center gap-3 min-w-0 flex-1">
                                                        <div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 flex-shrink-0">
                                                            <img 
                                                                src={`https://www.google.com/s2/favicons?domain=${site.url}&sz=32`} 
                                                                alt="icon" 
                                                                className="w-5 h-5 opacity-70"
                                                                onError={(e) => {e.target.style.display='none'}}
                                                            />
                                                        </div>
                                                        <div className="min-w-0">
                                                            <div className="font-medium text-gray-900 truncate">{site.name}</div>
                                                            <div className="text-xs text-gray-400 truncate max-w-[200px] hidden sm:block">{site.url}</div>
                                                        </div>
                                                    </div>

                                                    <div className="flex items-center gap-4 justify-end">
                                                        <div className="flex items-center gap-2 text-sm">
                                                            {samples.length > 0 ? (
                                                                <div className="flex gap-2 fade-in items-center">
                                                                    <div className={`flex flex-col items-center px-3 py-1 rounded-lg ${getLatencyColor(stats.avg)} min-w-[70px]`}>
                                                                        <span className="text-xs font-semibold uppercase opacity-70">平均</span>
                                                                        <span className="font-bold">{stats.avg} ms</span>
                                                                    </div>
                                                                    
                                                                    <div className="hidden sm:flex flex-col justify-center gap-1 text-xs text-gray-500 min-w-[60px]">
                                                                        <div className="flex justify-between gap-2">
                                                                            <span>最快:</span> <span className="font-medium text-gray-700">{stats.min}</span>
                                                                        </div>
                                                                        <div className="flex justify-between gap-2">
                                                                            <span>最慢:</span> <span className="font-medium text-gray-700">{stats.max}</span>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {/* Success/Fail/Total Counts */}
                                                                    <div className="flex items-center gap-2 ml-2 border-l pl-2 border-gray-200">
                                                                        <div className="flex flex-col items-center min-w-[35px]">
                                                                            <span className="text-[10px] text-gray-400">次數</span>
                                                                            <span className="text-xs font-bold text-gray-600">{samples.length}/{TEST_ROUNDS}</span>
                                                                        </div>
                                                                        <div className="flex flex-col items-center min-w-[35px]">
                                                                            <span className="text-[10px] text-green-500">成功</span>
                                                                            <span className="text-xs font-bold text-green-600">{stats.validCount}</span>
                                                                        </div>
                                                                        <div className="flex flex-col items-center min-w-[35px]">
                                                                            <span className="text-[10px] text-red-400">失敗</span>
                                                                            <span className="text-xs font-bold text-red-500">{stats.failCount}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <span className="text-xs text-gray-300 pr-4">等待測試...</span>
                                                            )}
                                                        </div>
                                                        
                                                        <div className="w-5 flex justify-center">
                                                            {loading && <div className="w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>}
                                                        </div>

                                                        <button 
                                                            onClick={() => removeSite(site.id)}
                                                            className="text-gray-300 hover:text-red-500 transition-colors"
                                                            title="從列表中移除"
                                                        >
                                                            <IconTrash2 className="w-4 h-4" />
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* Add New Site Form */}
                                <form onSubmit={handleAddSite} className="bg-white rounded-2xl shadow-sm p-4 flex flex-col gap-2">
                                    <div className="flex flex-col md:flex-row gap-3">
                                        <input
                                            type="text"
                                            placeholder="網站名稱 (選填)"
                                            className="px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                            value={newName}
                                            onChange={(e) => setNewName(e.target.value)}
                                        />
                                        <input
                                            type="text"
                                            placeholder="輸入網址 (例如: example.com)"
                                            className={`flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm ${errorMsg ? 'border-red-500 bg-red-50' : 'border-gray-200'}`}
                                            value={newUrl}
                                            onChange={(e) => setNewUrl(e.target.value)}
                                        />
                                        <button 
                                            type="submit"
                                            className="bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-gray-900 transition-colors flex items-center justify-center gap-2 text-sm font-medium whitespace-nowrap"
                                        >
                                            <IconPlus className="w-4 h-4" />
                                            加入列表
                                        </button>
                                    </div>
                                    {errorMsg && <div className="text-red-500 text-xs px-1">{errorMsg}</div>}
                                </form>
                            </div>

                            {/* Visual Chart Section */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-2xl shadow-sm p-5 h-full sticky top-6">
                                    <h3 className="font-semibold text-gray-700 flex items-center gap-2 mb-6">
                                        <IconBarChart3 className="w-4 h-4" />
                                        平均速度排名
                                    </h3>

                                    {allStats.length === 0 ? (
                                        <div className="h-48 flex flex-col items-center justify-center text-gray-400 text-sm border-2 border-dashed border-gray-100 rounded-xl">
                                            <IconWifiOff className="w-8 h-8 mb-2 opacity-50" />
                                            尚未有測試數據
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            {sites
                                                .map(site => {
                                                    const r = results[site.id];
                                                    const stats = r ? calculateStats(r.samples) : { avg: 0 };
                                                    return { ...site, stats };
                                                })
                                                .filter(item => item.stats.avg > 0)
                                                .sort((a, b) => a.stats.avg - b.stats.avg)
                                                .map((site) => {
                                                    const lat = site.stats.avg;
                                                    const maxLat = Math.max(...allStats.map(s => s.avg), 200);
                                                    const width = Math.max((lat / maxLat) * 100, 5);
                                                    
                                                    return (
                                                        <div key={site.id} className="group">
                                                            <div className="flex justify-between text-xs mb-1">
                                                                <span className="font-medium text-gray-600 truncate max-w-[120px]">{site.name}</span>
                                                                <span className="text-gray-500">{lat}ms</span>
                                                            </div>
                                                            <div className="w-full bg-gray-100 rounded-full h-2.5 overflow-hidden relative">
                                                                <div 
                                                                    className={`h-full rounded-full transition-all duration-500 ease-out ${
                                                                        lat < 200 ? 'bg-green-500' : lat < 500 ? 'bg-blue-500' : 'bg-orange-500'
                                                                    }`}
                                                                    style={{ width: `${width}%` }}
                                                                ></div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                        </div>
                                    )}

                                    <div className="mt-6 pt-6 border-t border-gray-100">
                                        <div className="flex items-start gap-2 text-xs text-gray-500">
                                            <IconAlertCircle className="w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5" />
                                            <p>
                                                <strong>注意：</strong> 
                                                目前採用 5 次循環測試取平均值。
                                                測試過程會看到每個網站被輪詢多次。
                                                最快/最慢/平均值皆已排除連線逾時的狀況。
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Footer Signature */}
                        <div className="text-center text-gray-400 text-sm mt-4 pb-6 font-mono">
                            Planning & Design by Timmy(timmyc@hauman.com.tw) | 豪勉科技 Hauman Technologies Corporation | Ver 1.0
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<NetworkSpeedTest />);
    </script>
</body>
</html>