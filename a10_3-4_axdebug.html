<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A10 Networks Thunder 實戰課程 - 故障排除與自動化</title>
    <!-- Google Fonts: Rubik -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind CSS (Utility classes) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Mermaid JS for Diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#101820', /* Midnight Blue-ish / Rich Black */
                        secondary: '#0047BB', /* Congress Blue */
                        accent: '#E6007E', /* Magenta */
                        highlight: '#FF8200', /* Orange */
                        light: '#F5F5F7', /* Light Grey */
                        paper: '#FFFFFF',
                    },
                    fontFamily: {
                        sans: ['Rubik', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Rubik', sans-serif;
            background-color: #F5F5F7;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Custom Header Gradient */
        .header-bg {
            background: linear-gradient(135deg, #020024 0%, #090979 35%, #00d4ff 100%);
            background: linear-gradient(to right, #101820, #0047BB);
        }

        /* Mermaid Diagram Styling */
        .mermaid {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
        }

        /* Quiz Styles */
        .quiz-option {
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            background-color: #f0f9ff;
            border-color: #0047BB;
        }
        .quiz-feedback {
            display: none;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tech Element Styling */
        code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f4f4f4;
            padding: 2px 5px;
            border-radius: 4px;
            color: #E6007E; /* Magenta for code snippets */
        }
        
        .cmd-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            border-left: 4px solid #FF8200; /* Orange Accent */
        }

        .section-title {
            position: relative;
            padding-left: 1rem;
        }
        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: #E6007E; /* Magenta Bar */
            border-radius: 2px;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header-bg text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fa-solid fa-network-wired text-highlight text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold tracking-wide">A10 Networks Thunder 實戰課程</h1>
            </div>
            <div class="hidden md:block text-sm text-gray-300">
                <span class="bg-white/10 px-3 py-1 rounded-full border border-white/20">Level 3 - Architect</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-5xl">
        
        <!-- Intro Hero -->
        <div class="bg-white rounded-xl shadow-sm p-8 mb-8 border-t-4 border-secondary">
            <!-- Title removed as requested -->
            <h3 class="text-2xl text-secondary font-bold mb-4">故障排除 (Troubleshooting)</h3>
            <p class="text-gray-600 leading-relaxed">
                本章節將深入探討 A10 ACOS 系統中的進階故障排除工具。我們將重點放在 <code>axdebug</code> 封包側錄分析，以及如何有效解讀 <code>show tech-support</code> 與系統日誌，讓您能像外科醫生一樣精準診斷網路疑難雜症。
            </p>
        </div>

        <!-- Section 1: Concept -->
        <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
            <h2 class="section-title text-2xl font-bold text-primary mb-6">一、核心概念 (Concept)</h2>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-light p-6 rounded-lg">
                    <div class="flex items-center mb-3">
                        <i class="fa-solid fa-lightbulb text-highlight text-xl mr-3"></i>
                        <h3 class="font-bold text-lg text-primary">一句話定義</h3>
                    </div>
                    <p class="text-gray-700">
                        <b>axdebug</b> 是 A10 專用的「硬體感知」封包擷取工具，能捕捉經過 FPGA/ASIC 加速的流量；而 <b>Tech-Support</b> 則是設備的「全身健康檢查報告」。
                    </p>
                </div>

                <div class="bg-light p-6 rounded-lg">
                    <div class="flex items-center mb-3">
                        <i class="fa-solid fa-mug-hot text-accent text-xl mr-3"></i>
                        <h3 class="font-bold text-lg text-primary">生活化比喻</h3>
                    </div>
                    <p class="text-gray-700">
                        想像高速公路 (網路流量) 上有裝設 ETC (ASIC 加速)。
                        <br><br>
                        一般的 Linux <code>tcpdump</code> 就像是「路邊的警察」，他只能看到走慢車道 (CPU) 的車，對於走 ETC 快速通道 (ASIC) 呼嘯而過的賽車完全看不到。
                        <br><br>
                        <b>axdebug</b> 就像是「高速攝影機」，不管車速多快、是否走 ETC 通道，都能精準拍下每一台車的照片。
                    </p>
                </div>
            </div>
        </div>

        <!-- Section 2: Mechanism -->
        <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
            <h2 class="section-title text-2xl font-bold text-primary mb-6">二、運作原理 (Mechanism)</h2>

            <div class="space-y-6">
                <div>
                    <h3 class="text-xl font-bold text-secondary mb-3">1. axdebug 的技術細節</h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-700 ml-2">
                        <li>
                            <strong class="text-primary">控制層面 vs. 數據層面：</strong> 
                            標準的 <code>tcpdump</code> 只能抓取 Control Plane (CPU) 的封包。ACOS 架構中，大部分流量由 Data Plane (FPGA/ASIC) 處理。<code>axdebug</code> 指令會下達過濾規則給硬體晶片，將符合條件的封包「鏡像 (Mirror)」一份給 CPU 紀錄，因此能看到完整的流量。
                        </li>
                        <li>
                            <strong class="text-primary">過濾器 (Filter) 的重要性：</strong> 
                            因為硬體流量巨大，必須設定精確的 Filter (如 IP, Port)，否則大量的 Debug 封包瞬間湧入 CPU 會導致設備效能下降 (High CPU Usage)。
                        </li>
                        <li>
                            <strong class="text-primary">輸出格式：</strong> 
                            支援將結果輸出為 <code>.pcap</code> 檔案，可直接下載並透過 Wireshark 分析。
                        </li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-secondary mb-3">2. 關鍵指令與參數</h3>
                    <div class="cmd-block text-sm">
                        # 設定過濾條件 (抓取來自 192.168.1.50 的所有流量)<br>
                        A10(config)# axdebug filter config 1 ip 192.168.1.50 /32<br>
                        <br>
                        # 設定輸出到檔案 (儲存 3000 個封包)<br>
                        A10(config)# axdebug capture save-config file my-capture.pcap count 3000<br>
                        <br>
                        # 啟用 Debug<br>
                        A10(config)# axdebug enable<br>
                        <br>
                        # 停止並匯出<br>
                        A10(config)# no axdebug enable<br>
                        A10# export axdebug my-capture.pcap tftp://10.0.0.1/
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-secondary mb-3">3. 廠商對照 (Competitor View)</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-100 border-b border-gray-200">
                                    <th class="p-3 font-semibold text-primary">Feature</th>
                                    <th class="p-3 font-semibold text-secondary">A10 Networks</th>
                                    <th class="p-3 font-semibold text-gray-600">F5 Networks</th>
                                    <th class="p-3 font-semibold text-gray-600">Cisco (IOS)</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-700 text-sm">
                                <tr class="border-b border-gray-100">
                                    <td class="p-3 font-medium">封包側錄指令</td>
                                    <td class="p-3 text-accent font-bold">axdebug</td>
                                    <td class="p-3">tcpdump (需加 -nnni 0.0:nnnp)</td>
                                    <td class="p-3">monitor capture</td>
                                </tr>
                                <tr class="border-b border-gray-100">
                                    <td class="p-3 font-medium">硬體加速流量</td>
                                    <td class="p-3">可直接抓取</td>
                                    <td class="p-3">需停用 PVA 或使用特定參數</td>
                                    <td class="p-3">需使用 Embedded Packet Capture</td>
                                </tr>
                                <tr class="border-b border-gray-100">
                                    <td class="p-3 font-medium">全系統檢測</td>
                                    <td class="p-3">show tech-support</td>
                                    <td class="p-3">qkview</td>
                                    <td class="p-3">show tech-support</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: Visuals -->
        <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
            <h2 class="section-title text-2xl font-bold text-primary mb-6">三、架構視覺化 (Visuals)</h2>
            <p class="text-gray-600 mb-4">以下展示 ACOS 系統中封包處理與 Debug 流程的垂直架構。</p>

            <!-- Diagram 1: Packet Flow & Debug Hook -->
            <div class="mb-8">
                <h4 class="text-lg font-bold text-center text-secondary mb-2">圖表 1: ACOS 封包處理與 axdebug 介入點</h4>
                <div class="mermaid">
                    flowchart TD
                        subgraph Client_Side
                            User[使用者]
                        end
                        
                        subgraph ACOS_Device
                            Ingress[介面進站 Ingress]
                            
                            subgraph Hardware_ASIC [Data Plane / ASIC]
                                L2L3[L2/L3 解析]
                                Filter_Check{符合 axdebug Filter?}
                                SLB_Logic[SLB 負載平衡決策]
                                NAT[NAT 轉換]
                            end
                            
                            subgraph Software_CPU [Control Plane / CPU]
                                Debug_Engine[axdebug 引擎]
                                Storage[(pcap 檔案)]
                            end
                            
                            Egress[介面出站 Egress]
                        end
                        
                        subgraph Server_Side
                            Server[後端伺服器]
                        end

                        User -->|原始封包| Ingress
                        Ingress --> L2L3
                        L2L3 --> Filter_Check
                        
                        Filter_Check -- 是 (Mirror Copy) --> Debug_Engine
                        Debug_Engine -->|寫入| Storage
                        
                        Filter_Check -- 否 (原本路徑) --> SLB_Logic
                        SLB_Logic --> NAT
                        NAT --> Egress
                        Egress -->|轉換後封包| Server
                        
                        style Filter_Check fill:#FF8200,stroke:#333,stroke-width:2px,color:white
                        style Debug_Engine fill:#E6007E,stroke:#333,stroke-width:2px,color:white
                        style Hardware_ASIC fill:#f0f9ff,stroke:#0047BB,stroke-dasharray: 5 5
                </div>
            </div>

            <!-- Diagram 2: Troubleshooting Workflow -->
            <div>
                <h4 class="text-lg font-bold text-center text-secondary mb-2">圖表 2: 標準故障排除流程 (Sequence Diagram)</h4>
                <div class="mermaid">
                    sequenceDiagram
                        participant Admin as 管理員
                        participant ACOS as A10 Thunder
                        participant Log as System Log
                        participant Debug as axdebug

                        Admin->>ACOS: 1. 接獲報修 (連線異常)
                        Admin->>ACOS: show log (檢查歷史紀錄)
                        ACOS-->>Admin: 回傳 Warning/Error Logs
                        
                        alt Log 資訊不足
                            Admin->>ACOS: 2. 設定 axdebug filter (IP/Port)
                            Admin->>ACOS: 3. axdebug enable (開始側錄)
                            Note over ACOS: 等待異常流量發生...
                            Admin->>ACOS: 4. no axdebug enable (停止側錄)
                            Admin->>ACOS: export axdebug (匯出 pcap)
                        else Log 已有明確錯誤 (如 Pool Down)
                            Admin->>ACOS: 直接修復配置
                        end

                        Admin->>Admin: 5. 使用 Wireshark 分析 pcap
                        Admin->>Admin: 6. 確認 3-Way Handshake 斷在哪
                </div>
            </div>
        </div>

        <!-- Section 4: Use Case -->
        <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
            <h2 class="section-title text-2xl font-bold text-primary mb-6">四、實務應用場景 (Use Case)</h2>
            
            <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 border border-gray-200">
                <h3 class="text-xl font-bold text-primary mb-4">案例：電商平台偶發性結帳失敗</h3>
                
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="col-span-2">
                        <p class="text-gray-700 mb-4">
                            <strong>情境描述：</strong><br>
                            某電商平台在促銷期間，部分使用者反應點擊「結帳」後畫面轉圈圈，最後顯示連線逾時。但監控系統顯示伺服器綠燈，CPU 使用率正常。
                        </p>
                        <p class="text-gray-700 mb-4">
                            <strong>處理步驟：</strong>
                        </p>
                        <ol class="list-decimal list-inside text-gray-700 space-y-2">
                            <li>詢問受影響客戶的 Public IP (例如 203.66.x.x)。</li>
                            <li>登入 A10，設定 Filter：<code>axdebug filter config 1 ip 203.66.x.x</code>。</li>
                            <li>設定抓取後端伺服器回應：同時監控 VIP 與 Real Server 的通訊。</li>
                            <li>啟用 <code>axdebug</code> 並請客戶重試結帳。</li>
                            <li>分析 pcap 發現：Client 送出 HTTP POST，A10 轉送給 Server，但 Server 回應了 <code>RST</code> (Reset) 封包，而非 <code>ACK</code>。</li>
                            <li><strong>結論：</strong> 問題出在後端應用程式崩潰主動斷線，而非網路不通。</li>
                        </ol>
                    </div>
                    
                    <div class="bg-white p-4 rounded shadow-sm h-fit">
                        <h4 class="font-bold text-secondary mb-3 text-sm uppercase tracking-wider">優點與缺點分析</h4>
                        <div class="space-y-4">
                            <div>
                                <div class="flex items-center text-green-600 font-bold mb-1">
                                    <i class="fa-solid fa-thumbs-up mr-2"></i> 優點
                                </div>
                                <p class="text-xs text-gray-600">證據確鑿，責任歸屬明確 (證明是 Server 端 Reset 連線，A10 網路層正常)。</p>
                            </div>
                            <div>
                                <div class="flex items-center text-red-500 font-bold mb-1">
                                    <i class="fa-solid fa-thumbs-down mr-2"></i> 缺點
                                </div>
                                <p class="text-xs text-gray-600">需精確設定 Filter，若設定錯誤 (如抓取 any)，可能導致 log 檔案過大或短暫影響效能。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 5: Quiz -->
        <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
            <h2 class="section-title text-2xl font-bold text-primary mb-6">五、隨堂測驗 (Quiz)</h2>
            <p class="text-gray-600 mb-6">請回答下列問題以檢視學習成果。</p>

            <div id="quiz-container" class="space-y-6">
                <!-- Quiz questions will be inserted here by JS -->
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-primary text-white py-6 mt-auto border-t-4 border-highlight">
        <div class="container mx-auto px-4 text-center text-sm font-light tracking-wide">
            <p>Planning & Design by Timmy(timmyc@hauman.com.tw) | 豪勉科技 Hauman Technologies Corporation | Ver 1.0</p>
        </div>
    </footer>

    <!-- JavaScript for Quiz -->
    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#0047BB',
                edgeLabelBackground: '#ffffff',
                tertiaryColor: '#f4f4f4'
            }
        });

        // Quiz Data
        const quizData = [
            {
                question: "1. 為什麼在 A10 Thunder 上建議使用 axdebug 而不是標準的 tcpdump？",
                options: [
                    "A. 因為 axdebug 介面比較漂亮",
                    "B. 因為 tcpdump 無法捕捉經過 ASIC/FPGA 硬體加速的流量",
                    "C. 因為 tcpdump 只能在 Windows 上執行",
                    "D. 因為 axdebug 不需要管理員權限"
                ],
                answer: 1, // Index of correct answer
                explanation: "標準的 tcpdump 運作於 Linux Kernel (Control Plane)，無法看見被硬體晶片 (Data Plane) 快速轉發的封包。axdebug 能與硬體溝通，將封包鏡像出來。"
            },
            {
                question: "2. 在執行 axdebug 之前，最關鍵的步驟是什麼？",
                options: [
                    "A. 重開機",
                    "B. 設定 Filter (過濾器) 指定特定 IP 或 Port",
                    "C. 拔除所有網路線",
                    "D. 升級韌體"
                ],
                answer: 1,
                explanation: "A10 處理流量極大，若不設定 Filter 直接抓取所有封包，會導致 CPU 瞬間滿載甚至當機。設定 Filter 是保護設備的必要步驟。"
            },
            {
                question: "3. 若希望將設備的完整配置、日誌、核心傾印(Core Dump)等資訊打包給原廠分析，應使用哪個指令？",
                options: [
                    "A. show run",
                    "B. show version",
                    "C. show tech-support",
                    "D. write memory"
                ],
                answer: 2,
                explanation: "show tech-support 指令會自動收集 show run, show log, debug info, hardware status 等所有診斷所需的資訊，是報修時的標準文件。"
            },
            {
                question: "4. A10 的 axdebug 抓取到的檔案，通常建議匯出成什麼格式以便在電腦上分析？",
                options: [
                    "A. .txt 文字檔",
                    "B. .jpg 圖片檔",
                    "C. .pcap 封包檔",
                    "D. .mp3 音訊檔"
                ],
                answer: 2,
                explanation: ".pcap 是標準的網路封包儲存格式，可使用 Wireshark 等工具開啟，進行詳細的逐層 (L2-L7) 分析。"
            },
            {
                question: "5. 在 F5 設備中對應 A10 `show tech-support` 的指令通常是？",
                options: [
                    "A. tcpdump",
                    "B. qkview",
                    "C. bigtop",
                    "D. tmsh list"
                ],
                answer: 1,
                explanation: "F5 的 qkview 工具會產生一個壓縮檔，包含所有的設定檔與診斷資訊，可上傳至 F5 iHealth 分析，功能等同於 A10 的 show tech-support。"
            }
        ];

        // Render Quiz
        const quizContainer = document.getElementById('quiz-container');

        quizData.forEach((item, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'border border-gray-200 rounded-lg p-6 bg-gray-50';
            
            let optionsHtml = '';
            item.options.forEach((opt, optIndex) => {
                optionsHtml += `
                    <label class="quiz-option flex items-center p-3 border border-gray-300 rounded cursor-pointer mb-2 bg-white">
                        <input type="radio" name="q${index}" value="${optIndex}" class="mr-3 h-4 w-4 text-secondary focus:ring-secondary">
                        <span class="text-gray-700">${opt}</span>
                    </label>
                `;
            });

            questionDiv.innerHTML = `
                <h4 class="font-bold text-lg text-primary mb-4">${item.question}</h4>
                <div class="space-y-2 mb-4">
                    ${optionsHtml}
                </div>
                <div id="feedback-${index}" class="quiz-feedback p-4 rounded bg-blue-50 border border-blue-200 text-blue-800 text-sm">
                    <p class="font-bold mb-1"><i class="fa-solid fa-circle-info mr-1"></i> 解析：</p>
                    ${item.explanation}
                </div>
            `;
            
            quizContainer.appendChild(questionDiv);

            // Add Event Listeners
            const inputs = questionDiv.querySelectorAll(`input[name="q${index}"]`);
            inputs.forEach(input => {
                input.addEventListener('change', (e) => {
                    const selected = parseInt(e.target.value);
                    const feedback = document.getElementById(`feedback-${index}`);
                    const allLabels = questionDiv.querySelectorAll('label');
                    
                    // Reset styles
                    allLabels.forEach(l => {
                        l.classList.remove('bg-green-100', 'border-green-500', 'bg-red-100', 'border-red-500');
                        l.classList.add('bg-white');
                    });

                    // Check answer
                    const selectedLabel = e.target.closest('label');
                    if (selected === item.answer) {
                        selectedLabel.classList.remove('bg-white');
                        selectedLabel.classList.add('bg-green-100', 'border-green-500');
                        selectedLabel.innerHTML += '<i class="fa-solid fa-check text-green-600 ml-auto"></i>';
                    } else {
                        selectedLabel.classList.remove('bg-white');
                        selectedLabel.classList.add('bg-red-100', 'border-red-500');
                        selectedLabel.innerHTML += '<i class="fa-solid fa-xmark text-red-600 ml-auto"></i>';
                        
                        // Highlight correct answer
                        const correctLabel = allLabels[item.answer];
                        correctLabel.classList.remove('bg-white');
                        correctLabel.classList.add('bg-green-100', 'border-green-500');
                        if(!correctLabel.querySelector('.fa-check')) {
                            correctLabel.innerHTML += '<i class="fa-solid fa-check text-green-600 ml-auto"></i>';
                        }
                    }

                    // Show feedback
                    feedback.style.display = 'block';
                    
                    // Disable radio buttons after selection
                    inputs.forEach(i => i.disabled = true);
                });
            });
        });
    </script>
</body>
</html>