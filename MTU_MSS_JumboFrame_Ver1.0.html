<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExtremeXOS ç¶²è·¯å¤§å¸«èª²ç¨‹ï¼šMTU èˆ‡ MSS æ·±åº¦è§£æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .mermaid { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); display: flex; justify-content: center; }
        .term-card:hover { transform: translateY(-5px); transition: all 0.3s ease; }
        .code-block { background-color: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 0.5rem; font-family: 'Courier New', Courier, monospace; overflow-x: auto; }
        .hidden-answer { filter: blur(5px); cursor: pointer; transition: filter 0.3s; }
        .hidden-answer:hover, .hidden-answer.revealed { filter: blur(0); }
        /* Mock Wireshark Styles */
        .wireshark-pane { background-color: #2d2d2d; color: #e6e6e6; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.9rem; border-radius: 0.5rem; overflow: hidden; border: 1px solid #444; }
        .ws-row { padding: 2px 8px; border-bottom: 1px solid #3d3d3d; display: flex; align-items: center; }
        .ws-row:hover { background-color: #3d3d3d; }
        .ws-icon { color: #8ab4f8; margin-right: 8px; font-size: 0.7rem; }
        .ws-highlight { background-color: #2c4c3b; color: #fff; padding: 0 4px; border-radius: 2px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Navbar -->
    <nav class="bg-purple-900 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fa-solid fa-network-wired text-2xl"></i>
                <h1 class="text-xl font-bold">ExtremeXOS ç¶²è·¯æ¶æ§‹å¤§å¸«</h1>
            </div>
            <div class="text-sm bg-purple-800 px-3 py-1 rounded-full">
                ä¸»é¡Œï¼šMTUã€MSS èˆ‡ Jumbo Frame å…¨æ”»ç•¥
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 max-w-5xl">

        <!-- Header Section -->
        <header class="mb-12 text-center">
            <h2 class="text-4xl font-bold text-slate-900 mb-4">ç‚ºä»€éº¼ç¶²é æ‰“ä¸é–‹ï¼Œä½†åœ¨é€™å» Ping å¾—åˆ°ï¼Ÿ</h2>
            <p class="text-xl text-slate-600">æ·±å…¥ç†è§£å°åŒ…ç ´ç¢ (Fragmentation)ã€Jumbo Frame èˆ‡å‚³è¼¸æ•ˆèƒ½</p>
        </header>

        <!-- ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ (Concept) -->
        <section class="mb-16">
            <div class="flex items-center space-x-2 mb-6 border-b-2 border-purple-500 pb-2">
                <div class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">1</div>
                <h3 class="text-2xl font-bold">æ ¸å¿ƒæ¦‚å¿µ (Concept)</h3>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- MTU Card -->
                <div class="bg-white p-6 rounded-xl shadow-md term-card border-l-4 border-blue-500">
                    <div class="flex items-center mb-4">
                        <i class="fa-solid fa-ruler-horizontal text-3xl text-blue-500 mr-3"></i>
                        <h4 class="text-xl font-bold">MTU (Maximum Transmission Unit)</h4>
                    </div>
                    <p class="text-gray-600 mb-4"><span class="font-bold">å®šç¾©ï¼š</span>æœ€å¤§å‚³è¼¸å–®å…ƒã€‚æŒ‡çš„æ˜¯ç¬¬äºŒå±¤ï¼ˆData Link Layerï¼‰ç¶²è·¯ä»‹é¢æ‰€èƒ½é€šéçš„æœ€å¤§å°åŒ…å¤§å°ï¼ˆä¸å« Ethernet Headerï¼‰ã€‚</p>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h5 class="font-bold text-blue-800 mb-2"><i class="fa-solid fa-lightbulb"></i> ç”Ÿæ´»åŒ–æ¯”å–»ï¼šéš§é“çš„é™é«˜</h5>
                        <p class="text-sm text-blue-700">
                            æƒ³åƒç¶²è·¯ç·šæ˜¯ä¸€æ¢<b>éš§é“</b>ã€‚MTU å°±æ˜¯é€™å€‹éš§é“çš„<b>ã€Œé™é«˜/é™å¯¬ã€</b>ï¼ˆæ¨™æº–ä¹™å¤ªç¶²ç‚º 1500 bytesï¼‰ã€‚<br>
                            å¦‚æœä¸éµå®ˆé€™å€‹é™åˆ¶ï¼Œè»Šå­ï¼ˆå°åŒ…ï¼‰å°±å¿…é ˆè¢«æ‹†è§£ï¼ˆåˆ†ç‰‡ï¼‰æ‰èƒ½é€šéï¼Œæˆ–è€…ç›´æ¥æ’ç‰†ï¼ˆDropï¼‰ã€‚
                        </p>
                    </div>
                </div>

                <!-- MSS Card -->
                <div class="bg-white p-6 rounded-xl shadow-md term-card border-l-4 border-green-500">
                    <div class="flex items-center mb-4">
                        <i class="fa-solid fa-box-open text-3xl text-green-500 mr-3"></i>
                        <h4 class="text-xl font-bold">MSS (Maximum Segment Size)</h4>
                    </div>
                    <p class="text-gray-600 mb-4"><span class="font-bold">å®šç¾©ï¼š</span>æœ€å¤§å€æ®µå¤§å°ã€‚æŒ‡çš„æ˜¯ TCP å°åŒ…ä¸­ï¼Œã€Œå¯¦éš›èƒ½è£è¼‰è³‡æ–™ï¼ˆPayloadï¼‰ã€çš„æœ€å¤§é‡ã€‚</p>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h5 class="font-bold text-green-800 mb-2"><i class="fa-solid fa-lightbulb"></i> ç”Ÿæ´»åŒ–æ¯”å–»ï¼šå¡è»Šçš„è²¨æ«ƒå®¹é‡</h5>
                        <p class="text-sm text-green-700">
                            å¦‚æœæ•´å€‹ IP å°åŒ…æ˜¯ä¸€è¼›<b>å¡è»Š</b>ï¼Œæ‰£é™¤è»Šé ­ï¼ˆIP Headerï¼‰å’Œé§•é§›åº§ï¼ˆTCP Headerï¼‰ï¼Œå‰©ä¸‹çš„<b>ã€Œè²¨æ«ƒç©ºé–“ã€</b>å°±æ˜¯ MSSã€‚<br>
                            å¦‚æœè²¨ç‰©å¤ªå¤šï¼Œæˆ‘å€‘å¿…é ˆå”å•†å¥½æ¯æ¬¡åªè¼‰å¤šå°‘è²¨ï¼ˆMSSï¼‰ï¼Œæ‰ä¸æœƒè®“æ•´å°å¡è»Šè¶…ééš§é“çš„é™é«˜ï¼ˆMTUï¼‰ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- äºŒã€é‹ä½œåŸç† (Mechanism) -->
        <section class="mb-16">
            <div class="flex items-center space-x-2 mb-6 border-b-2 border-purple-500 pb-2">
                <div class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">2</div>
                <h3 class="text-2xl font-bold">é‹ä½œåŸç†èˆ‡è¨ˆç®— (Mechanism)</h3>
            </div>

            <!-- Interactive Calculator -->
            <div class="bg-slate-800 text-white p-6 rounded-xl shadow-lg mb-8">
                <h4 class="text-lg font-bold mb-4 text-purple-300"><i class="fa-solid fa-calculator"></i> å‚³è¼¸å±¤/ç¶²è·¯å±¤è² è¼‰è¨ˆç®—æ©Ÿ (TCP / UDP / ICMP)</h4>
                <div class="grid md:grid-cols-3 gap-6 items-end">
                    <!-- Column 1: MTU Input -->
                    <div>
                        <label class="block text-sm mb-1 text-gray-400">ç¶²è·¯ä»‹é¢ MTU (Bytes)</label>
                        <input type="number" id="mtuInput" value="1500" class="w-full bg-slate-700 border border-slate-600 rounded p-2 text-white focus:outline-none focus:border-purple-500" oninput="calculate()">
                        <p class="text-xs text-gray-500 mt-1">æ¨™æº–ä¹™å¤ªç¶²é è¨­ç‚º 1500</p>
                    </div>

                    <!-- Column 2: Protocol Selection & Overhead -->
                    <div>
                        <div class="flex justify-center space-x-4 mb-3">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="protocol" value="tcp" checked onchange="calculate()" class="w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 focus:ring-purple-500">
                                <span class="ml-2 text-sm font-medium text-gray-300">TCP</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="protocol" value="udp" onchange="calculate()" class="w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 focus:ring-purple-500">
                                <span class="ml-2 text-sm font-medium text-gray-300">UDP</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="protocol" value="icmp" onchange="calculate()" class="w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 focus:ring-purple-500">
                                <span class="ml-2 text-sm font-medium text-gray-300">ICMP</span>
                            </label>
                        </div>

                        <div id="overheadDetails" class="space-y-1 mb-2">
                            <!-- JS will populate this -->
                        </div>

                        <div class="w-full h-10 bg-slate-700 rounded flex items-center justify-center text-gray-400 border border-slate-600 border-dashed text-sm">
                            ç¸½ Header é–‹éŠ· = <span id="overheadTotal" class="mx-1 text-white font-bold">40</span> Bytes
                        </div>
                    </div>

                    <!-- Column 3: Result -->
                    <div>
                        <label class="block text-sm mb-1 text-green-400 font-bold" id="resultLabel">TCP MSS (Payload)</label>
                        <div class="w-full bg-green-900 border border-green-600 rounded p-2 text-green-300 font-mono text-xl text-center" id="calcResult">
                            1460
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h4 class="font-bold text-lg mb-3">é—œéµæŠ€è¡“ç´°ç¯€</h4>
                <ul class="list-disc pl-5 space-y-2 text-gray-700">
                    <li><span class="font-bold text-purple-700">TCP MSS è¨ˆç®—ï¼š</span> MTU - IP Header (20) - TCP Header (20) = é è¨­ 1460ã€‚é€™æ˜¯ TCP ä¸‰å‘äº¤æ¡æ™‚å”å•†çš„å…§å®¹ã€‚</li>
                    <li><span class="font-bold text-purple-700">UDP Payload è¨ˆç®—ï¼š</span> UDP Header ä½” 8 Bytesã€‚æœ€å¤§ Payload = MTU - 28ã€‚è‹¥è¶…éæ­¤å€¼ä¸” DF=1ï¼Œæœƒè¢«ä¸Ÿæ£„ã€‚</li>
                    <li><span class="font-bold text-purple-700">ICMP Data è¨ˆç®—ï¼š</span> ICMP Header ä½” 8 Bytesã€‚è‹¥è¦é€²è¡Œ Ping æ¸¬è©¦ä¸”ä¸åˆ†ç‰‡ (Do not Fragment)ï¼Œè³‡æ–™é•·åº¦ (Data Size) ä¸èƒ½è¶…é MTU - 28ã€‚</li>
                    <li><span class="font-bold text-purple-700">DF Bit (Don't Fragment)ï¼š</span> ç¾ä»£ä½œæ¥­ç³»çµ±é€šå¸¸å°‡ IP å°åŒ…çš„ DF ä½å…ƒè¨­ç‚º 1ã€‚å¦‚æœå°åŒ…å¤§æ–¼è·¯å¾‘ä¸ŠæŸè¨­å‚™çš„ MTU ä¸” DF=1ï¼Œè·¯ç”±å™¨æœƒä¸Ÿæ£„å°åŒ…ä¸¦å›å‚³ ICMP Type 3 Code 4 (Fragmentation Needed)ã€‚</li>
                </ul>
            </div>
        </section>

        <!-- ä¸‰ã€æ¶æ§‹è¦–è¦ºåŒ– (Visuals) -->
        <section class="mb-16">
            <div class="flex items-center space-x-2 mb-6 border-b-2 border-purple-500 pb-2">
                <div class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">3</div>
                <h3 class="text-2xl font-bold">æ¶æ§‹è¦–è¦ºåŒ– (Visuals)</h3>
            </div>

            <div class="space-y-8">
                <!-- Diagram 1: Packet Structure (Traditional Horizontal View) -->
                <div>
                    <h4 class="text-center font-bold mb-4 text-gray-600 text-xl">ä¹™å¤ªç¶²å°åŒ…çµæ§‹</h4>
                    <div class="mermaid">
                        graph LR
                            %% Nodes representing fields horizontally
                            EthH["Ethernet Header<br>(14 Bytes)"]
                            
                            subgraph MTU_Zone ["MTU (1500 Bytes)"]
                                direction LR
                                IPH["IP Header<br>(20 Bytes)"]
                                L4H["TCP/UDP Header<br>(20/8 Bytes)"]
                                Data["Data Payload<br>(MSS)"]
                            end
                            
                            FCS["FCS<br>(4 Bytes)"]

                            %% Connections
                            EthH --- IPH --- L4H --- Data --- FCS

                            %% Styling
                            classDef eth fill:#e2e8f0,stroke:#64748b;
                            classDef ip fill:#dbeafe,stroke:#3b82f6;
                            classDef l4 fill:#dcfce7,stroke:#22c55e;
                            classDef data fill:#fef9c3,stroke:#eab308;
                            classDef fcs fill:#f1f5f9,stroke:#94a3b8;
                            classDef mtuZone fill:#f8fafc,stroke:#334155,stroke-dasharray: 5 5;

                            class EthH eth;
                            class IPH ip;
                            class L4H l4;
                            class Data data;
                            class FCS fcs;
                            class MTU_Zone mtuZone;
                    </div>
                    <p class="text-center text-sm text-gray-500 mt-2">å‚³çµ±ç·šæ€§å°åŒ…çµæ§‹ï¼šå·¦è‡³å³ä¾åºæ’åˆ—ï¼Œè™›ç·šæ¡†å…§ç‚º MTU ç¯„åœ</p>
                </div>

                <!-- Diagram 2: TCP MSS Negotiation -->
                <div>
                    <h4 class="text-center font-bold mb-4 text-gray-600 text-xl">TCP MSS å”å•†éç¨‹</h4>
                    <div class="mermaid">
                        sequenceDiagram
                            participant PC as ä½¿ç”¨è€…é›»è…¦<br/>(MTU 1500)
                            participant Router as VPN è·¯ç”±å™¨<br/>(MTU 1400)
                            participant Server as ç¶²ç«™ä¼ºæœå™¨<br/>(MTU 1500)

                            Note over PC, Server: ä¸‰å‘äº¤æ¡éšæ®µ (SYN)
                            PC->>Server: SYN (MSS=1460)
                            Note right of PC: æœ¬åœ° 1500 - 40 = 1460
                            
                            Server->>PC: SYN, ACK (MSS=1460)
                            Note left of Server: ä¼ºæœå™¨ä¹Ÿèªç‚ºå®ƒæ˜¯ 1460

                            Note over PC, Server: è³‡æ–™å‚³è¼¸éšæ®µ (å•é¡Œç™¼ç”Ÿ)
                            PC->>Router: ç™¼é€ 1500 bytes å°åŒ… (DF=1)
                            Router--xRouter: å°åŒ…å¤ªå¤§ (1500 > 1400) ä¸” DF=1
                            Router-->>PC: ICMP Type 3 Code 4 (éœ€åˆ†ç‰‡ä½† DF è¨­ç‚º 1)
                            
                            Note over PC, Server: è§£æ±ºæ–¹æ¡ˆï¼šMSS Clamping
                            Note right of Router: è·¯ç”±å™¨ä¿®æ”¹ SYN å°åŒ…ä¸­çš„ MSS
                            PC->>Router: SYN (MSS=1460)
                            Router->>Server: SYN (MSS=1360) <br/>(å¼·åˆ¶ä¿®æ”¹ç‚º 1400-40)
                    </div>
                </div>
            </div>
        </section>

        <!-- å››ã€å°åŒ…åˆ†æå¯¦æˆ° (Packet Analysis) - NEW SECTION -->
        <section class="mb-16">
            <div class="flex items-center space-x-2 mb-6 border-b-2 border-purple-500 pb-2">
                <div class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">4</div>
                <h3 class="text-2xl font-bold">å°åŒ…åˆ†æå¯¦æˆ°ï¼šWireshark è£¡çš„ MSS</h3>
            </div>
            
            <div class="grid md:grid-cols-5 gap-8">
                <!-- Explainer Text -->
                <div class="md:col-span-2 space-y-4">
                    <p class="text-gray-700">
                        è¦é©—è­‰ MSS æ˜¯å¦æ­£ç¢ºï¼Œæœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯æŠ“å°åŒ… (Packet Capture)ã€‚MSS æ•¸å€¼ä½æ–¼ <strong>TCP Header</strong> çš„ <strong>Options</strong> æ¬„ä½ä¸­ã€‚
                    </p>
                    <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400">
                        <h5 class="font-bold text-yellow-800 mb-2">ğŸ” è§€å¯Ÿé‡é»</h5>
                        <ul class="list-disc pl-5 text-sm text-yellow-800 space-y-1">
                            <li><strong>å°åŒ…é¡å‹ï¼š</strong>åªå‡ºç¾åœ¨ <span class="bg-gray-200 px-1 rounded font-mono text-gray-700">SYN</span> æˆ– <span class="bg-gray-200 px-1 rounded font-mono text-gray-700">SYN, ACK</span> å°åŒ…ä¸­ã€‚</li>
                            <li><strong>å”å•†åŸå‰‡ï¼š</strong>é›™æ–¹æœƒæ¯”è¼ƒå½¼æ­¤çš„ MSSï¼Œä¸¦ä½¿ç”¨ã€Œè¼ƒå°ã€çš„å€¼ä½œç‚ºæœ€çµ‚å‚³è¼¸ä¸Šé™ã€‚</li>
                            <li><strong>ä½ç½®ï¼š</strong>TCP å±¤ > Options > Maximum segment sizeã€‚</li>
                        </ul>
                    </div>
                    <p class="text-sm text-gray-500">
                        å¦‚æœä¸­é–“ç¶“é VPN è¨­å‚™é€²è¡Œäº† MSS Clampingï¼Œä½ æœƒç™¼ç¾é›–ç„¶ä¾†æºç«¯é€å‡º 1460ï¼Œä½†æ¥æ”¶ç«¯æ”¶åˆ°çš„ SYN å°åŒ…ä¸­ï¼ŒMSS å·²ç¶“è¢«ä¿®æ”¹ï¼ˆä¾‹å¦‚è®Šæˆ 1360ï¼‰ã€‚
                    </p>
                </div>

                <!-- Mock Wireshark UI -->
                <div class="md:col-span-3">
                    <div class="bg-gray-800 rounded-t-lg p-2 flex items-center space-x-2 border-b border-gray-600">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        <span class="text-gray-400 text-xs ml-2 font-mono">Wireshark - Packet 1 [SYN]</span>
                    </div>
                    <div class="wireshark-pane rounded-t-none border-t-0 h-full shadow-2xl">
                        <!-- Frame -->
                        <div class="ws-row">
                            <i class="fa-solid fa-caret-right ws-icon"></i> Frame 1: 66 bytes on wire (528 bits), 66 bytes captured
                        </div>
                        <!-- Ethernet -->
                        <div class="ws-row">
                            <i class="fa-solid fa-caret-right ws-icon"></i> Ethernet II, Src: Intel_a1:b2:c3, Dst: Extreme_d4:e5:f6
                        </div>
                        <!-- IP -->
                        <div class="ws-row">
                            <i class="fa-solid fa-caret-right ws-icon"></i> Internet Protocol Version 4, Src: 192.168.1.10, Dst: 8.8.8.8
                        </div>
                        <!-- TCP Expanded -->
                        <div class="ws-row bg-gray-700">
                            <i class="fa-solid fa-caret-down ws-icon"></i> Transmission Control Protocol, Src Port: 54321, Dst Port: 443, Seq: 0
                        </div>
                        <div class="ws-row pl-8 border-none text-gray-400">
                            Source Port: 54321
                        </div>
                        <div class="ws-row pl-8 border-none text-gray-400">
                            Destination Port: 443
                        </div>
                        <div class="ws-row pl-8 border-none text-gray-400">
                            .... 0000 0000 0010 = Flags: 0x002 (SYN)
                        </div>
                        <!-- TCP Options Expanded -->
                        <div class="ws-row pl-8">
                            <i class="fa-solid fa-caret-down ws-icon"></i> Options: (12 bytes), Maximum segment size, No-Operation...
                        </div>
                        <!-- MSS Highlighted -->
                        <div class="ws-row pl-12 bg-gray-600 border-l-4 border-green-500">
                            <i class="fa-solid fa-caret-down ws-icon"></i> <span class="ws-highlight">TCP Option - Maximum segment size: 1460 bytes</span>
                        </div>
                        <div class="ws-row pl-16 border-none text-green-300">
                            Kind: Maximum Segment Size (2)
                        </div>
                        <div class="ws-row pl-16 border-none text-green-300">
                            Length: 4
                        </div>
                        <div class="ws-row pl-16 border-none text-green-300">
                            MSS Value: 1460
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- äº”ã€å¯¦å‹™æ‡‰ç”¨å ´æ™¯ (Use Case) - VPN Focus -->
        <section class="mb-16">
            <div class="flex items-center space-x-2 mb-6 border-b-2 border-purple-500 pb-2">
                <div class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">5</div>
                <h3 class="text-2xl font-bold">å¯¦å‹™æ‡‰ç”¨ï¼šVPN èˆ‡ MSS Clamping</h3>
            </div>

            <!-- Use Case Content -->
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <h4 class="text-xl font-bold mb-3 flex items-center"><i class="fa-solid fa-triangle-exclamation text-orange-500 mr-2"></i> å•é¡Œï¼šVPN é€£ç·šå¾Œéƒ¨åˆ†ç¶²é æ‰“ä¸é–‹</h4>
                <p class="mb-4 text-gray-700">ç•¶ä¼æ¥­ä½¿ç”¨ GRE Tunnel æˆ– IPsec VPN æ™‚ï¼Œé¡å¤–çš„ Header æœƒä½”ç”¨ç©ºé–“ã€‚å¦‚æœä¸èª¿æ•´ MSSï¼ŒServer é€ä¾†çš„å¤§å°åŒ…æœƒè¢«ä¸­é–“çš„ VPN Gateway ä¸Ÿæ£„ï¼Œé€ æˆé€£ç·šä¸ç©©ã€‚</p>
                
                <h5 class="font-bold text-gray-800 mb-2">è§£æ±ºæ–¹æ¡ˆï¼šTCP MSS Clamping (Adjust)</h5>
                <p class="text-sm text-gray-600 mb-2">åœ¨è·¯ç”±å™¨ä»‹é¢ä¸Šå¼·åˆ¶ä¿®æ”¹é€šéçš„ TCP SYN å°åŒ…ä¸­çš„ MSS å€¼ã€‚</p>
                
                <div class="grid md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <div class="bg-gray-800 text-gray-200 px-3 py-1 text-sm rounded-t">Cisco IOS</div>
                        <pre class="code-block rounded-t-none">
interface Tunnel0
 ip tcp adjust-mss 1360
! é€šå¸¸å»ºè­°å€¼ç‚º MTU - 40
                        </pre>
                    </div>
                    <div>
                        <div class="bg-purple-900 text-gray-200 px-3 py-1 text-sm rounded-t">ExtremeXOS / VOSS</div>
                        <pre class="code-block rounded-t-none">
# ExtremeXOS é€šå¸¸åœ¨ VLAN å±¤ç´šè¨­å®š
configure vlan "VPN-Vlan" ip-mtu 1400

# é‡å° TCP MSS Adjustment (éƒ¨åˆ†å‹è™Ÿ/ç‰ˆæœ¬)
configure ip tcp-mss 1360 vlan "VPN-Vlan"
                        </pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- å…­ã€æ•ˆèƒ½æ€ªç¸ï¼šJumbo Frame (New Section) -->
        <section class="mb-16">
            <div class="flex items-center space-x-2 mb-6 border-b-2 border-purple-500 pb-2">
                <div class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">6</div>
                <h3 class="text-2xl font-bold">æ•ˆèƒ½æ€ªç¸ï¼šJumbo Frame (å·¨å‹å°åŒ…)</h3>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 mb-8">
                <!-- Layout changed to flex-col for better readability -->
                <div class="flex flex-col gap-6">
                    <div>
                        <h4 class="text-xl font-bold text-indigo-700 mb-2">ä»€éº¼æ˜¯ Jumbo Frame?</h4>
                        <p class="text-gray-700 mb-4">
                            æ¨™æº–ä¹™å¤ªç¶²çš„ MTU æ˜¯ 1500 Bytesã€‚è€Œ Jumbo Frame å…è¨±å°‡ MTU æé«˜åˆ° <span class="font-bold text-red-600">9000 Bytes</span> ç”šè‡³æ›´é«˜ï¼ˆExtremeXOS æ”¯æ´åˆ° 9216ï¼‰ã€‚
                        </p>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-bold text-gray-800 mb-2"><i class="fa-solid fa-truck-moving text-indigo-500"></i> æ¯”å–»ï¼šæ¬å®¶å·¥ç¨‹</h5>
                                <ul class="list-disc pl-5 space-y-2 text-gray-600 text-sm">
                                    <li><span class="font-bold">æ¨™æº–å°åŒ… (1500)ï¼š</span> åƒç”¨å°è²¨è»Šæ¬å®¶ã€‚æ¬å®Œä¸€å€‹å®¶éœ€è¦è·‘ 6 è¶Ÿï¼Œæ¯è¶Ÿéƒ½è¦é‡æ–°ç™¼å‹•å¼•æ“ã€éæ”¶è²»ç«™ (Header Overhead)ã€‚</li>
                                    <li><span class="font-bold">Jumbo Frame (9000)ï¼š</span> åƒç”¨å¤§å‹è²¨æ«ƒè»Šæ¬å®¶ã€‚è·‘ 1 è¶Ÿå°±æ¬å®Œäº†ã€‚ç¯€çœäº† 5 æ¬¡çš„ç™¼å‹•èˆ‡éç«™æ™‚é–“ã€‚</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-bold text-gray-800 mb-2">å„ªé» (Benefits)</h5>
                                <ul class="list-disc pl-5 space-y-1 text-gray-600 text-sm">
                                    <li><span class="font-bold text-green-600">æå‡å‚³è¼¸æ•ˆç‡ï¼š</span> æ¸›å°‘äº† Header ä½”ç”¨çš„æ¯”ä¾‹ (Payload Ratio ä¸Šå‡)ã€‚</li>
                                    <li><span class="font-bold text-green-600">é™ä½ CPU è² è¼‰ï¼š</span> ç›¸åŒè³‡æ–™é‡ä¸‹ï¼Œå°åŒ…æ•¸é‡æ¸›å°‘ï¼Œç¶²å¡çš„ CPU ä¸­æ–· (Interrupts) æ¬¡æ•¸å¤§å¹…ä¸‹é™ã€‚é€™å° iSCSI å„²å­˜ç¶²è·¯è‡³é—œé‡è¦ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Visualization of Efficiency (Full width & Syntax Fixed) -->
                    <div class="w-full">
                        <h4 class="text-center font-bold mb-4 text-gray-600 text-xl">å‚³è¼¸æ•ˆç‡å°æ¯”åœ– (å°åŒ…æµæ¯”è¼ƒ)</h4>
                        <div class="mermaid">
                            graph LR
                                %% Visualizing Overhead comparison
                                
                                subgraph STD ["æ¨™æº–å‚³è¼¸ (6 x 1500 Bytes)"]
                                    direction LR
                                    S1["Head|Data"] --- S2["Head|Data"] --- S3["Head|Data"] --- S4["Head|Data"] --- S5["Head|Data"] --- S6["Head|Data"]
                                end
                                
                                subgraph JUMBO ["Jumbo Frame (1 x 9000 Bytes)"]
                                    direction LR
                                    J1["Header | --------------------------------------------- Huge Data Payload ---------------------------------------------"]
                                end
                                
                                %% Styling
                                classDef stdPacket fill:#e2e8f0,stroke:#64748b,stroke-width:1px;
                                classDef jumboPacket fill:#dcfce7,stroke:#16a34a,stroke-width:2px;
                                
                                class S1,S2,S3,S4,S5,S6 stdPacket;
                                class J1 jumboPacket;
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-2">ä¸Šæ–¹éœ€è¦ 6 å€‹ Header é–‹éŠ·ï¼Œä¸‹æ–¹åƒ…éœ€ 1 å€‹ã€‚Jumbo Frame å¤§å¹…æ¸›å°‘äº†ã€Œéè·¯è²»ã€(Overhead)ã€‚</p>
                    </div>
                </div>
            </div>

            <!-- Risk Diagram -->
            <div class="bg-red-50 p-6 rounded-xl border-l-4 border-red-500 mb-8">
                <h4 class="text-xl font-bold text-red-700 mb-3"><i class="fa-solid fa-skull-crossbones"></i> æ¥µåº¦é‡è¦ï¼šç«¯å°ç«¯ä¸€è‡´æ€§ (End-to-End)</h4>
                <p class="text-gray-700 mb-4">
                    Jumbo Frame å°±åƒä¸€è¼›è¶…å¯¬å¡è»Šï¼Œè·¯å¾‘ä¸Š<span class="font-bold">æ‰€æœ‰çš„æ©‹æ¨‘èˆ‡éš§é“ (Switch, Router, Server, Storage)</span> éƒ½å¿…é ˆæ‹“å¯¬ (æ”¯æ´ MTU 9000)ã€‚åªè¦ä¸­é–“æœ‰ä¸€å€‹è¨­å‚™åªæ”¯æ´ 1500ï¼Œå°åŒ…å°±æœƒè¢«ä¸Ÿæ£„ (Drop)ï¼Œå°è‡´é€£ç·šä¸­æ–·ã€‚
                </p>
                <div class="mermaid">
                    graph LR
                        A[Server A<br>MTU 9000] --OK--> B[Extreme Switch<br>MTU 9000]
                        B --OK--> C[Storage Array<br>MTU 9000]
                        B -- "DROP!" --> D[Legacy Switch<br>MTU 1500]
                        D -.- E[Server B<br>MTU 9000]
                        
                        style A fill:#dcfce7,stroke:#16a34a
                        style B fill:#dcfce7,stroke:#16a34a
                        style C fill:#dcfce7,stroke:#16a34a
                        style D fill:#fee2e2,stroke:#ef4444,stroke-width:2px
                        style E fill:#f3f4f6,stroke:#9ca3af,stroke-dasharray: 5 5
                        
                        linkStyle 2 stroke:#ef4444,stroke-width:3px,color:red
                </div>
            </div>

            <!-- ExtremeXOS Config for Jumbo -->
            <div class="bg-gray-800 text-gray-200 p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-bold text-purple-300"><i class="fa-solid fa-terminal"></i> ExtremeXOS å¯¦æˆ°æŒ‡ä»¤</h4>
                    <span class="text-xs bg-purple-700 px-2 py-1 rounded">EXOS 30.x+</span>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <p class="text-sm text-gray-400 mb-1">1. å…¨åŸŸå•Ÿç”¨ Jumbo Frame (Layer 2 ä»‹é¢å±¤ç´š)</p>
                        <pre class="code-block">enable jumbo-frame ports all
# æˆ–è€…æŒ‡å®šç‰¹å®š Port
enable jumbo-frame ports 1:1,1:2,2:1-10</pre>
                    </div>

                    <div>
                        <p class="text-sm text-gray-400 mb-1">2. è¨­å®š VLAN çš„ IP MTU (Layer 3 è·¯ç”±å±¤ç´š)</p>
                        <p class="text-xs text-gray-500 mb-1">*åƒ…ç•¶ Switch éœ€è¦å° Jumbo å°åŒ…é€²è¡Œ Routing æ™‚æ‰éœ€è¦è¨­å®š</p>
                        <pre class="code-block">configure vlan "iSCSI_VLAN" ip-mtu 9000</pre>
                    </div>

                    <div>
                        <p class="text-sm text-gray-400 mb-1">3. é©—è­‰è¨­å®š (Verification)</p>
                        <pre class="code-block">show port 1:1 info detail
# å°‹æ‰¾è¼¸å‡ºä¸­çš„ "Max Frame Size"
# é è¨­ Jumbo ä¸Šé™é€šå¸¸ç‚º 9216 Bytes</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- ä¸ƒã€éš¨å ‚æ¸¬é©— (Quiz) -->
        <section class="mb-16">
            <div class="flex items-center space-x-2 mb-6 border-b-2 border-purple-500 pb-2">
                <div class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">7</div>
                <h3 class="text-2xl font-bold">å¤§å¸«éš¨å ‚æ¸¬é©— (Quiz)</h3>
            </div>
            
            <div class="space-y-4">
                <!-- Q1 -->
                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold mb-2">Q1. æ¨™æº–ä¹™å¤ªç¶² (Ethernet) çš„é è¨­ MTU æ˜¯å¤šå°‘ Bytesï¼Ÿ</p>
                    <div class="space-y-1">
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, false)">A. 1518</button>
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, true)">B. 1500</button>
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, false)">C. 1460</button>
                    </div>
                    <div class="hidden-answer text-sm text-blue-600 mt-2 p-2 bg-blue-50 rounded" onclick="this.classList.add('revealed')">
                        <span class="font-bold">è§£æï¼š</span> ç­”æ¡ˆæ˜¯ Bã€‚1500 æ˜¯ Payload (IP Packet) çš„ä¸Šé™ã€‚1518 åŒ…å«äº† Ethernet Header (14) + FCS (4)ã€‚
                    </div>
                </div>

                <!-- Q2 -->
                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold mb-2">Q2. é—œæ–¼ Jumbo Frame çš„éƒ¨ç½²ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ</p>
                    <div class="space-y-1">
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, false)">A. åªè¦ä¼ºæœå™¨ç«¯é–‹å•Ÿ 9000 MTU å³å¯ï¼ŒSwitch æœƒè‡ªå‹•é©æ‡‰</button>
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, true)">B. å‚³è¼¸è·¯å¾‘ä¸Šæ‰€æœ‰è¨­å‚™ (Server, Switch, Storage) éƒ½å¿…é ˆæ”¯æ´ä¸¦è¨­å®šä¸€è‡´çš„ MTU</button>
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, false)">C. Jumbo Frame ä¸»è¦ç”¨æ–¼ 100Mbps çš„ç¶²è·¯ç’°å¢ƒ</button>
                    </div>
                    <div class="hidden-answer text-sm text-blue-600 mt-2 p-2 bg-blue-50 rounded" onclick="this.classList.add('revealed')">
                        <span class="font-bold">è§£æï¼š</span> ç­”æ¡ˆæ˜¯ Bã€‚Jumbo Frame å¿…é ˆ End-to-End ä¸€è‡´ã€‚ä¸­é–“åªè¦æœ‰ä¸€å°è¨­å‚™ MTU è¼ƒå° (1500)ï¼Œå°±æœƒå°è‡´å°åŒ…éºå¤± (Drop)ï¼Œå› ç‚º Layer 2 é€šå¸¸ä¸é€²è¡Œåˆ†ç‰‡ã€‚
                    </div>
                </div>

                <!-- Q3 -->
                <div class="bg-white p-4 rounded shadow">
                    <p class="font-bold mb-2">Q3. åœ¨ ExtremeXOS ä¸­ï¼Œé–‹å•Ÿ Jumbo Frame çš„æŒ‡ä»¤ç‚ºä½•ï¼Ÿ</p>
                    <div class="space-y-1">
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, true)">A. enable jumbo-frame ports all</button>
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, false)">B. configure ip-mtu 9000</button>
                        <button class="w-full text-left p-2 hover:bg-gray-100 rounded" onclick="checkAnswer(this, false)">C. set port jumbo on</button>
                    </div>
                    <div class="hidden-answer text-sm text-blue-600 mt-2 p-2 bg-blue-50 rounded" onclick="this.classList.add('revealed')">
                        <span class="font-bold">è§£æï¼š</span> ç­”æ¡ˆæ˜¯ Aã€‚`enable jumbo-frame ports` ç”¨æ–¼ Layer 2 å¯¦é«”å±¤ç´šã€‚`configure ip-mtu` æ˜¯ç”¨æ–¼ Layer 3 VLAN ä»‹é¢ã€‚
                    </div>
                </div>
            </div>

        </section>

        <footer class="text-center text-gray-500 text-sm mt-12 mb-8 border-t border-gray-200 pt-8">
            <p class="font-bold text-slate-700">Planning & Design by Timmy(timmyc@hauman.com.tw) | è±ªå‹‰ç§‘æŠ€ Hauman Technologies Corporation | Ver 1.0</p>
            <p class="text-xs mt-2">Disclaimer: æŒ‡ä»¤åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›æ“ä½œè«‹ä¾æ“šè¨­å‚™ç‰ˆæœ¬æ‰‹å†Š (EXOS User Guide) ç‚ºæº–ã€‚</p>
        </footer>

    </main>

    <script>
        // Initialization
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({ startOnLoad: true });
            calculate();
        });

        // Combined Calculator Logic
        function calculate() {
            const mtu = parseInt(document.getElementById('mtuInput').value) || 0;
            const ipHeader = 20;
            const protocol = document.querySelector('input[name="protocol"]:checked').value;
            
            let protoHeader = 0;
            let resultLabelText = "";
            
            const detailContainer = document.getElementById('overheadDetails');
            
            if (protocol === 'tcp') {
                protoHeader = 20;
                resultLabelText = "TCP MSS (Payload)";
                detailContainer.innerHTML = `
                    <div class="flex justify-between text-xs text-gray-400"><span>æ‰£é™¤ IP Header</span><span>-20 Bytes</span></div>
                    <div class="flex justify-between text-xs text-gray-400"><span>æ‰£é™¤ TCP Header</span><span>-20 Bytes</span></div>
                `;
            } else if (protocol === 'udp') {
                protoHeader = 8;
                resultLabelText = "Max UDP Payload";
                detailContainer.innerHTML = `
                    <div class="flex justify-between text-xs text-gray-400"><span>æ‰£é™¤ IP Header</span><span>-20 Bytes</span></div>
                    <div class="flex justify-between text-xs text-gray-400"><span>æ‰£é™¤ UDP Header</span><span>-8 Bytes</span></div>
                `;
            } else {
                // ICMP
                protoHeader = 8;
                resultLabelText = "Max ICMP Data";
                detailContainer.innerHTML = `
                    <div class="flex justify-between text-xs text-gray-400"><span>æ‰£é™¤ IP Header</span><span>-20 Bytes</span></div>
                    <div class="flex justify-between text-xs text-gray-400"><span>æ‰£é™¤ ICMP Header</span><span>-8 Bytes</span></div>
                `;
            }

            const totalOverhead = ipHeader + protoHeader;
            const result = mtu - totalOverhead;
            
            // Update UI
            document.getElementById('overheadTotal').textContent = totalOverhead;
            document.getElementById('resultLabel').textContent = resultLabelText;
            
            const resultElement = document.getElementById('calcResult');
            resultElement.textContent = result > 0 ? result : "ç„¡æ•ˆæ•¸å€¼";
            
            if (result <= 0) {
                resultElement.classList.replace('bg-green-900', 'bg-red-900');
                resultElement.classList.replace('text-green-300', 'text-red-300');
            } else {
                resultElement.classList.replace('bg-red-900', 'bg-green-900');
                resultElement.classList.replace('text-red-300', 'text-green-300');
            }
        }

        // Quiz Logic
        function checkAnswer(btn, isCorrect) {
            const allBtns = btn.parentElement.querySelectorAll('button');
            allBtns.forEach(b => {
                b.classList.remove('bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
                b.disabled = true;
            });

            if (isCorrect) {
                btn.classList.add('bg-green-100', 'text-green-800');
                btn.innerHTML += ' <i class="fa-solid fa-check ml-2"></i>';
            } else {
                btn.classList.add('bg-red-100', 'text-red-800');
                btn.innerHTML += ' <i class="fa-solid fa-xmark ml-2"></i>';
            }
        }
    </script>
</body>
</html>