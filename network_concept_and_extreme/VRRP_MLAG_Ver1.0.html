<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRRP + MLAG 高可用性架構深度解析</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Mermaid JS for Diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Google Fonts: Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
        }
        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 5px solid #6366f1; /* Indigo-500 */
        }
        .concept-icon {
            color: #4f46e5;
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background-color: #f8fafc;
            padding: 10px;
            border-radius: 8px;
        }
        .quiz-option {
            transition: all 0.2s;
        }
        .quiz-option:hover {
            background-color: #eef2ff;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-indigo-900 text-white p-6 shadow-lg">
        <div class="container mx-auto">
            <h1 class="text-3xl font-bold"><i class="fa-solid fa-network-wired mr-3"></i>VRRP + MLAG 高可用性架構解析</h1>
            <p class="mt-2 text-indigo-200">解決 L2 迴圈與實現 Active-Active 路由的最佳實踐</p>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8 max-w-5xl">

        <!-- Intro -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-8 text-blue-900 rounded-r">
            <p class="font-bold">講師前言：</p>
            <p>在傳統的雙核心設計中，我們常遇到一個兩難：為了備援連接了兩條線，結果為了怕廣播風暴 (Loop)，STP 協定把其中一條線給封鎖了，導致一半的頻寬被浪費。今天我們來探討如何利用 ExtremeXOS 的 MLAG 技術，結合 VRRP，不僅解決風暴問題，還能讓兩台核心交換器同時工作 (Active-Active)！</p>
        </div>

        <!-- Section 1: Core Concepts -->
        <div class="section-card">
            <h2 class="text-2xl font-bold mb-4 text-indigo-800">一、核心概念 (Concept)</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- VRRP -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-xl font-bold mb-2 text-indigo-600">VRRP (虛擬路由器備援協定)</h3>
                    <p class="mb-2"><strong>一句話定義：</strong>多台路由器共用一個虛擬 IP (VIP)，當主機掛掉時，備機自動接手，讓使用者無感。</p>
                    <p class="text-gray-600 italic"><i class="fa-solid fa-lightbulb text-yellow-500 mr-2"></i><strong>生活化比喻：</strong>就像公司的總經理 (Master) 和副總經理 (Backup)。對外代表公司的電話號碼 (VIP) 只有一支，平時都由總經理接聽，只有總經理請病假時，副總經理才會接起這支電話。</p>
                </div>

                <!-- MLAG -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-xl font-bold mb-2 text-indigo-600">MLAG (跨機箱鏈路聚合)</h3>
                    <p class="mb-2"><strong>一句話定義：</strong>讓兩台實體交換器，在下層設備眼中「偽裝」成同一台交換器，實現頻寬加倍與無縫備援。</p>
                    <p class="text-gray-600 italic"><i class="fa-solid fa-lightbulb text-yellow-500 mr-2"></i><strong>生活化比喻：</strong>就像兩條單線道的高速公路入口，合併成一個寬闊的收費站。駕駛 (封包) 根本不在乎走哪條車道，反正都能通往同一個目的地，而且兩條路可以同時通車，不會塞車。</p>
                </div>
            </div>
        </div>

        <!-- Section 2: Mechanism & The Problem -->
        <div class="section-card">
            <h2 class="text-2xl font-bold mb-4 text-indigo-800">二、運作原理與痛點解決 (Mechanism)</h2>
            
            <div class="mb-6">
                <h3 class="text-lg font-bold text-red-600 mb-2"><i class="fa-solid fa-triangle-exclamation mr-2"></i>傳統架構的痛點：廣播風暴與資源浪費</h3>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>為何會形成迴圈？</strong> 兩台 Core 交換器為了確認對方是否存活 (VRRP Heartbeat)，<strong>必須</strong>建立一條橫向的互連線路。這條線路加上兩台 Core 分別下接到 Access Switch 的線路，三者在物理上就圍成了一個封閉的三角形 (Loop)。</li>
                    <li><strong>廣播風暴風險：</strong>廣播封包 (Broadcast) 會順著這個三角形路徑無限循環。若沒有 STP 機制，只需幾秒鐘就能癱瘓整個網路。</li>
                    <li><strong>STP 的代價：</strong>為了防止風暴，STP 會強制 Block (阻斷) 其中一條鏈路。結果是：<strong>雖然買了兩條線、兩台設備，卻只有一台在工作，另一台純待命，浪費 50% 效能。</strong></li>
                    <li><strong>VRRP 的限制：</strong>標準 VRRP 只有 Master 會轉發封包，Backup 收到的封包會被丟棄 (Drop)，無法達成負載平衡。</li>
                </ul>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-bold text-green-600 mb-2"><i class="fa-solid fa-check-circle mr-2"></i>ExtremeXOS MLAG 的解決方案</h3>
                
                <div class="bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-400 mb-4">
                    <h4 class="font-bold text-indigo-800 mb-2">關鍵技術詳解：ISC Link (Inter-Switch Connection)</h4>
                    <p class="text-sm mb-2">MLAG 的核心在於兩台 Core Switch 之間的這條 ISC 連線。它不僅僅是一條線，而是一個複雜的通道：</p>
                    <ul class="list-disc pl-5 text-sm space-y-1">
                        <li><strong>物理組成 (LACP Trunk)：</strong>為了避免這條關鍵鏈路成為單點故障或頻寬瓶頸，我們<strong>通常使用多個實體介面綁定成 LACP</strong> 來建立 ISC。</li>
                        <li><strong>VLAN 結構 (ISC + User VLANs)：</strong>這條 Trunk 裡面跑了兩類 VLAN：
                            <ul class="list-disc pl-5 mt-1 text-gray-600">
                                <li><strong>ISC VLAN (Control)：</strong>專用 VLAN，用來同步兩台設備的 MLAG 狀態表與 VRRP 狀態。</li>
                                <li><strong>User VLANs (Data)：</strong>這點最重要！ISC 必須同時承載所有使用者的 VLAN (如 vlan 10, 20)。</li>
                            </ul>
                        </li>
                        <li><strong>環狀形成的根本原因：</strong>正因為 ISC Link 承載了 User VLAN，加上兩台 Core 下接到 Access Switch 的線路也承載了同樣的 User VLAN，這三條路徑在物理上對 User VLAN 形成了一個完美的<strong>環狀 (Ring)</strong>。</li>
                    </ul>
                    <p class="text-sm mt-2 font-bold text-indigo-700">這就是為什麼我們需要 MLAG！MLAG 協定透過特殊的控制機制，將這個物理環狀「隱藏」起來，讓下層設備與 STP 誤以為這是一條直線，從而避免了 Block，同時解決了廣播風暴。</p>
                </div>

                <ol class="list-decimal pl-6 space-y-3">
                    <li><strong>邏輯虛擬化：</strong>L3-A 與 L3-B 透過 ISC 同步狀態，將兩台實體設備模擬成單一邏輯節點。因此，物理上的「三角形」在邏輯上變成了「直線」，<strong>消除了 L2 迴圈，不再需要 STP Block 端口</strong>。</li>
                    <li><strong>VRRP 狀態同步：</strong>L3-A 與 L3-B 透過 ISC 傳遞 VRRP Hello 封包，不需要經過下層網路，避免了風暴風險。</li>
                    <li><strong>Active-Active 轉發 (關鍵技術)：</strong>在 ExtremeXOS 中，啟用 Fabric Routing 後，VRRP Backup 也能轉發封包。這意味著，無論流量流向 L3-A 還是 L3-B，兩台都能同時進行路由轉發，頻寬利用率達到 100%。</li>
                </ol>
            </div>

            <div class="bg-gray-100 p-4 rounded text-sm font-mono border border-gray-300">
                <p class="font-bold text-gray-700">// ExtremeXOS 關鍵參數設定範例</p>
                <p class="text-gray-500 mb-1"># 設定 ISC 的 LACP 與 VLAN Tag</p>
                <p>enable sharing 1 grouping 1-2 algorithm address-based L2  <span class="text-green-600"><-- 建立 ISC LACP Trunk</span></p>
                <p>configure vlan "ISC_Vlan" add ports 1 tagged  <span class="text-green-600"><-- 加入 Control VLAN</span></p>
                <p>configure vlan "User_Vlan" add ports 1 tagged  <span class="text-green-600"><-- 加入 User VLAN (形成環狀的主因)</span></p>
                <p class="mt-2 text-gray-500"># 設定 MLAG Peer</p>
                <p>create mlag peer "peer_To_SW2"</p>
                <p>configure mlag peer "peer_To_SW2" ipaddress 192.168.100.2 vr VR-Default</p>
                <p>enable mlag port 10 peer "peer_To_SW2" id 10</p>
            </div>
        </div>

        <!-- Section 3: Visualization -->
        <div class="section-card">
            <h2 class="text-2xl font-bold mb-4 text-indigo-800">三、架構視覺化 (Visuals)</h2>

            <h3 class="font-bold text-gray-700">1. 問題場景：傳統 VRRP 的物理迴圈</h3>
            <p class="text-sm text-gray-500">為了讓兩台 L3 Core 交換 VRRP 狀態，必須連接一條橫向線路。這與下方的 Access Switch 形成了一個物理三角形 (Loop)。<br>若無 STP 介入，廣播封包將在此迴圈無限繞行 (紅色路徑)；若 STP 介入，則必須阻斷一邊 (橘色虛線)，造成浪費。</p>
            <div class="mermaid">
                flowchart TD
                    %% 定義節點
                    subgraph Core_Layer ["Core Layer (L3)"]
                        direction LR
                        L3_A["L3 SW-A<br/>(VRRP Master)"]
                        L3_B["L3 SW-B<br/>(VRRP Backup)"]
                    end
                    
                    subgraph Access_Layer ["Access Layer (L2)"]
                        L2_User["Access Switch<br/>(L2)"]
                    end

                    %% 定義連線與迴圈路徑
                    L3_A <==>|1. VRRP Keepalive Link| L3_B
                    L3_A <==>|2. Uplink Main| L2_User
                    L3_B -.-x|3. STP Blocking| L2_User

                    %% 樣式設定
                    style L3_A fill:#d1fae5,stroke:#059669,stroke-width:2px
                    style L3_B fill:#fee2e2,stroke:#b91c1c,stroke-width:2px
                    style L2_User fill:#e0f2fe,stroke:#0284c7,stroke-width:2px
                    
                    %% 強調迴圈的連線顏色
                    linkStyle 0 stroke:#ef4444,stroke-width:3px,color:#b91c1c
                    linkStyle 1 stroke:#22c55e,stroke-width:3px,color:#15803d
                    linkStyle 2 stroke:#f59e0b,stroke-width:2px,stroke-dasharray: 5 5,color:#b45309
            </div>

            <div class="my-8 border-t border-gray-200"></div>

            <h3 class="font-bold text-gray-700">2. 解決方案：MLAG + VRRP Active-Active</h3>
            <p class="text-sm text-gray-500">
                <strong>特別注意 VRRP 角色：</strong> 雖然系統仍有 Master 與 Backup 之分 (控制層面)，但在資料層面 (Data Plane)，兩者皆能主動轉發流量。
            </p>
            <div class="mermaid">
                graph TD
                    subgraph "Logical Core (MLAG Domain)"
                        %% 這裡明確標示 VRRP 角色
                        L3_A["L3 SW-A<br/>(VRRP Master)"]
                        L3_B["L3 SW-B<br/>(VRRP Backup)"]
                        
                        %% ISC 詳細描述
                        ISC[("ISC Link (LACP Trunk)<br/>VLANs: ISC + User Data")]
                        
                        L3_A <==> ISC <==> L3_B
                    end
                    
                    subgraph "Access Layer"
                        L2_User[User Access Switch]
                    end

                    L3_A == "LACP Member 1 (Active)<br/>Carrying User VLAN" ==> L2_User
                    L3_B == "LACP Member 2 (Active)<br/>Carrying User VLAN" ==> L2_User
                    
                    %% Logic representation
                    note[下層 L2 Switch 看到的是單一個 LACP Trunk]
                    L2_User -.-> note

                    style ISC fill:#fef3c7,stroke:#d97706,stroke-width:4px
                    style L3_A fill:#d1fae5,stroke:#059669
                    style L3_B fill:#d1fae5,stroke:#059669
            </div>

            <div class="my-8 border-t border-gray-200"></div>

            <h3 class="font-bold text-purple-700">3. 進階架構：多網段 VRRP 分流 (VRRP Load Balancing)</h3>
            <p class="text-sm text-gray-600 mb-2">
                當網路環境有多個網段 (Subnet) 時，我們可以將不同的 VLAN Master 角色分配給不同的核心交換器。<br>
                雖然 MLAG 已經允許雙主動轉發，但這種設計可以<strong>平衡控制層面 (Control Plane) 的負載</strong> (如 ARP 請求處理)，避免單一設備 CPU 過忙。
            </p>
            <div class="mermaid">
                graph TD
                    subgraph "Core Layer (MLAG Domain)"
                        %% 定義 L3-A 的角色
                        L3_A["L3 SW-A<br/>(Master: VLAN 10)<br/>(Backup: VLAN 20)"]
                        
                        %% 定義 L3-B 的角色
                        L3_B["L3 SW-B<br/>(Backup: VLAN 10)<br/>(Master: VLAN 20)"]
                        
                        %% ISC 明確標示 VLAN 10, 20
                        ISC[("ISC Link<br/>(LACP Trunk)<br/>VLANs: ISC, 10, 20")]
                        L3_A <==> ISC <==> L3_B
                    end
                    
                    subgraph "Different Network Segments"
                        %% 網段 1 (VLAN 10)
                        SW_10["Access SW (VLAN 10)<br/>Gateway: 192.168.10.254"]
                        
                        %% 網段 2 (VLAN 20)
                        SW_20["Access SW (VLAN 20)<br/>Gateway: 192.168.20.254"]
                    end

                    %% 連線關係
                    L3_A == "MLAG Link" ==> SW_10
                    L3_B == "MLAG Link" ==> SW_10
                    
                    L3_A == "MLAG Link" ==> SW_20
                    L3_B == "MLAG Link" ==> SW_20
                    
                    %% 樣式
                    style L3_A fill:#e0e7ff,stroke:#4338ca,stroke-width:2px
                    style L3_B fill:#e0e7ff,stroke:#4338ca,stroke-width:2px
                    style SW_10 fill:#dcfce7,stroke:#166534
                    style SW_20 fill:#ffedd5,stroke:#9a3412
                    style ISC fill:#fef3c7,stroke:#d97706,stroke-width:4px
            </div>

        </div>

        <!-- Section 4: Use Case -->
        <div class="section-card">
            <h2 class="text-2xl font-bold mb-4 text-indigo-800">四、實務應用場景 (Use Case)</h2>
            <div class="bg-white border border-gray-200 rounded-lg p-6">
                <h3 class="text-xl font-bold mb-2">企業核心網路 (Core Network) 無縫升級</h3>
                <p class="mb-4"><strong>場景描述：</strong>某大型醫院需要 24/7 不中斷的醫療資訊系統 (HIS)。舊架構使用單純 VRRP，當主核心交換器故障切換時，STP 重新收斂需要 30-50 秒，導致掛號系統短暫斷線。</p>
                <p class="mb-4"><strong>導入 MLAG 設計：</strong>
                    <ul class="list-disc pl-6">
                        <li><strong>部署方式：</strong>在兩台 ExtremeXOS 核心交換器之間建立 <strong>ISC (Inter-Switch Connection)</strong>，並將下接樓層交換器的 Port 設定為 MLAG Id。</li>
                        <li><strong>VRRP 優化：</strong>啟用 Fabric Routing (Active-Active)，讓兩台核心同時處理資料庫流量。</li>
                    </ul>
                </p>
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div class="p-3 bg-green-50 rounded border border-green-200">
                        <span class="font-bold text-green-700">優點 (Pros)</span>
                        <ul class="text-sm list-disc pl-4 mt-1">
                            <li>頻寬利用率從 50% 提升至 100%。</li>
                            <li>故障切換時間 (Failover) 低於 1 秒 (因為線路本來就是 Active 的)。</li>
                            <li>消除 STP 複雜度與計算錯誤風險。</li>
                        </ul>
                    </div>
                    <div class="p-3 bg-red-50 rounded border border-red-200">
                        <span class="font-bold text-red-700">缺點/注意事項 (Cons)</span>
                        <ul class="text-sm list-disc pl-4 mt-1">
                            <li>設定較複雜，需確保 ISC 鏈路穩定 (通常建議用多條線做 LACP)。</li>
                            <li>兩台設備的韌體版本建議保持一致。</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 5: Quiz -->
        <div class="section-card">
            <h2 class="text-2xl font-bold mb-4 text-indigo-800">五、隨堂測驗 (Quiz)</h2>
            <p class="mb-4 text-gray-600">請回答下列問題以測試您對 VRRP 與 MLAG 架構的理解。</p>

            <div id="quiz-container" class="space-y-6">
                <!-- Question 1 -->
                <div class="quiz-item" data-answer="B">
                    <p class="font-bold text-lg mb-2">1. 在不使用 MLAG 的情況下，兩台 L3 交換器下接同一台 L2 交換器形成環狀，通常依賴什麼協定來防止廣播風暴？</p>
                    <div class="space-y-2">
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'A')">A. DHCP</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'B')">B. STP (Spanning Tree Protocol)</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'C')">C. OSPF</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'D')">D. VRRP</button>
                    </div>
                    <div class="result hidden mt-2 p-3 rounded"></div>
                </div>

                <!-- Question 2 -->
                <div class="quiz-item" data-answer="C">
                    <p class="font-bold text-lg mb-2">2. MLAG 架構中，關於 ISC Link (Inter-Switch Connection) 的描述，何者正確？</p>
                    <div class="space-y-2">
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'A')">A. 它只允許傳輸控制訊號，不能傳輸資料 VLAN</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'B')">B. 它是物理上唯一不會形成環狀的線路</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'C')">C. 它通常是 LACP Trunk，同時承載 ISC VLAN 與 User VLANs</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'D')">D. 它必須使用 Console 線連接</button>
                    </div>
                    <div class="result hidden mt-2 p-3 rounded"></div>
                </div>

                <!-- Question 3 -->
                <div class="quiz-item" data-answer="A">
                    <p class="font-bold text-lg mb-2">3. 結合 VRRP 與 MLAG 的最大好處之一是實現了「Active-Active」轉發。這意味著什麼？</p>
                    <div class="space-y-2">
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'A')">A. Master 和 Backup 都能同時轉發流量，頻寬加倍</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'B')">B. 只有 Master 能轉發，Backup 負責監控</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'C')">C. 兩台設備共用同一個實體 MAC 位址</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'D')">D. 可以省略 ISC 連線</button>
                    </div>
                    <div class="result hidden mt-2 p-3 rounded"></div>
                </div>

                <!-- Question 4 -->
                <div class="quiz-item" data-answer="D">
                    <p class="font-bold text-lg mb-2">4. 從下層 L2 交換器 (Access Switch) 的視角來看，上層啟用了 MLAG 的兩台核心交換器看起來像什麼？</p>
                    <div class="space-y-2">
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'A')">A. 兩台完全獨立的路由器</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'B')">B. 一台 DNS 伺服器</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'C')">C. 兩條互相衝突的線路</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'D')">D. 單一邏輯設備 (單一 LACP Trunk)</button>
                    </div>
                    <div class="result hidden mt-2 p-3 rounded"></div>
                </div>

                <!-- Question 5 -->
                <div class="quiz-item" data-answer="B">
                    <p class="font-bold text-lg mb-2">5. 為何單純使用 VRRP (無 MLAG) 時，Backup 路由器通常無法利用其下行頻寬？</p>
                    <div class="space-y-2">
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'A')">A. 因為 Backup 路由器沒有電源</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'B')">B. 因為 STP 通常會阻斷 Backup 的下行端口以防迴圈</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'C')">C. 因為 Backup 路由器的 CPU 比較慢</button>
                        <button class="quiz-option w-full text-left p-3 border rounded hover:bg-indigo-50" onclick="checkAnswer(this, 'D')">D. 因為 ExtremeXOS 不支援 Backup 功能</button>
                    </div>
                    <div class="result hidden mt-2 p-3 rounded"></div>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer with specific signature -->
    <footer class="bg-gray-800 text-gray-400 py-4 mt-8">
        <div class="container mx-auto text-center text-sm">
            Planning & Design by Timmy(timmyc@hauman.com.tw) | 豪勉科技 Hauman Technologies Corporation | Ver 1.0
        </div>
    </footer>

    <!-- Quiz Script -->
    <script>
        function checkAnswer(btn, selection) {
            const parent = btn.closest('.quiz-item');
            const correctAnswer = parent.getAttribute('data-answer');
            const resultDiv = parent.querySelector('.result');
            
            // Disable all buttons in this question
            const buttons = parent.querySelectorAll('button');
            buttons.forEach(b => b.disabled = true);

            if (selection === correctAnswer) {
                btn.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                resultDiv.innerHTML = '<i class="fa-solid fa-check-circle text-green-500 mr-2"></i><strong>答對了！</strong> ' + getExplanation(correctAnswer);
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('bg-green-50', 'text-green-800', 'border', 'border-green-200');
            } else {
                btn.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                // Highlight correct answer
                buttons.forEach(b => {
                    if (b.innerText.startsWith(correctAnswer)) {
                        b.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                    }
                });
                resultDiv.innerHTML = '<i class="fa-solid fa-xmark-circle text-red-500 mr-2"></i><strong>答錯了。</strong> ' + getExplanation(correctAnswer);
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('bg-red-50', 'text-red-800', 'border', 'border-red-200');
            }
        }

        function getExplanation(answer) {
            switch(answer) {
                case 'A': return "Active-Active 讓兩台設備都能處理流量，這是 MLAG + VRRP 的最大優勢。";
                case 'B': return "STP (生成樹協定) 的主要功能就是阻斷多餘路徑以防止 L2 迴圈。";
                case 'C': return "正因為 ISC 承載了 User VLAN，加上下行鏈路，才會在物理上形成環狀，這正是需要 MLAG 的原因。";
                case 'D': return "MLAG 透過 LACP 協定，讓兩條物理線路在邏輯上看起來像一條 Trunk，因此下層設備認為只連接到一台設備。";
                default: return "正確答案詳見上方解析。";
            }
        }

        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</body>
</html>