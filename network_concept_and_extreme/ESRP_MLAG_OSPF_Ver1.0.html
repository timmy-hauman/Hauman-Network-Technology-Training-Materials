<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExtremeXOS 架構教學：ESRP 多網域負載平衡</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Mermaid JS for Diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Google Fonts: Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .main-container {
            flex: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        .section-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            margin-bottom: 2rem;
            border-left: 6px solid #662d91; /* Extreme Networks Purple vibe */
            transition: transform 0.2s;
        }
        .section-card:hover {
            transform: translateY(-2px);
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        .section-title i {
            margin-right: 0.75rem;
            color: #662d91;
        }
        .concept-box {
            background-color: #f8f0fc; /* Light Purple bg */
            border: 1px solid #e9d5ff;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .highlight-term {
            color: #d53f8c;
            font-weight: bold;
        }
        .mermaid-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            margin-top: 1rem;
        }
        .quiz-option {
            transition: all 0.2s;
            cursor: pointer;
        }
        .quiz-option:hover {
            background-color: #edf2f7;
        }
        footer {
            background-color: #2d3748;
            color: #cbd5e0;
            text-align: center;
            padding: 1rem;
            font-size: 0.85rem;
            margin-top: auto;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-gradient-to-r from-purple-800 to-indigo-900 text-white py-8 shadow-lg">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-3xl font-bold mb-2"><i class="fa-solid fa-network-wired mr-3"></i>ExtremeXOS 進階架構</h1>
            <p class="text-purple-200 text-lg">ESRP 多網域負載平衡 (Multi-Domain Load Balancing)</p>
        </div>
    </header>

    <div class="main-container">

        <!-- Intro -->
        <div class="bg-white p-6 rounded-lg shadow-sm mb-8 border-l-4 border-blue-500">
            <p class="text-gray-700 leading-relaxed">
                <i class="fa-solid fa-user-tie text-blue-500 mr-2"></i>
                <strong>講師導言：</strong>
                大家好。進階架構的核心在於「<strong>不要讓一台 Core Switch 扛下所有工作</strong>」。
                我們可以透過設定，讓 Core A 擔任業務部 (VLAN 10) 的 Master，Core B 擔任工程部 (VLAN 20) 的 Master。
                為了實現這一點，我們需要一條強大的互連通道，同時承載控制訊號 (ISC)、使用者流量 (L2) 以及跨網段的路由交換 (L3)。
            </p>
        </div>

        <!-- Section 1: Concept -->
        <section class="section-card">
            <div class="section-title">
                <i class="fa-solid fa-lightbulb"></i>
                一、核心概念 (Concept)
            </div>
            
            <div class="space-y-6">
                <div>
                    <h3 class="font-bold text-gray-800 text-lg mb-2">一句話定義</h3>
                    <p class="text-gray-600 pl-4 border-l-4 border-gray-300">
                        將不同 VLAN 的 ESRP Master 角色分散配置於兩台 Core Switch 上，並透過整合型 Trunk 鏈路同時處理 L2 備援與 L3 動態路由。
                    </p>
                </div>

                <div class="concept-box">
                    <h3 class="font-bold text-purple-800 text-lg mb-2"><i class="fa-solid fa-mug-hot mr-2"></i>生活化比喻：雙向通行的快速道路</h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                        <li><strong>多網域負載平衡：</strong> 就像一間公司有兩個大門，A 門專門負責進貨 (VLAN 10)，B 門專門負責出貨 (VLAN 20)，大家不用擠同一個門。</li>
                        <li><strong>整合互連鏈路 (Integrated Link)：</strong> 這是連通 A 門與 B 門的中央走道。
                            <br>- 保全人員 (ISC) 在這裡巡邏確認兩個門都開著。
                            <br>- 員工 (VLAN 10/20) 可以從這裡經過。
                            <br>- 經理 (OSPF/RIP) 也透過這裡交換情報。
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 2: Mechanism -->
        <section class="section-card">
            <div class="section-title">
                <i class="fa-solid fa-gears"></i>
                二、運作原理 (Mechanism)
            </div>

            <div class="space-y-6 text-gray-700 leading-relaxed">
                
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h4 class="font-bold text-blue-800 mb-2"><i class="fa-solid fa-list-check mr-2"></i>Master 分散策略</h4>
                    <ul class="list-disc list-inside space-y-1 ml-2 text-sm text-gray-700">
                        <li><strong>Domain 1 (VLAN 10):</strong> Core A = Master, Core B = Standby</li>
                        <li><strong>Domain 2 (VLAN 20):</strong> Core B = Master, Core A = Standby</li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-bold text-indigo-700 mb-2">互連鏈路 (Inter-Switch Link) 的多重角色</h4>
                    <p class="mb-3">
                        在實務上，我們通常會將兩台 Core Switch 之間的多條實體線路綁定為一個 LAG (Link Aggregation Group)，並設定為 Trunk Port，同時承載以下封包：
                    </p>
                    <ul class="list-disc list-inside bg-gray-50 p-3 rounded text-sm space-y-1">
                        <li><strong>ISC VLAN：</strong> 用於 MLAG 狀態同步與 ESRP Hello 封包。</li>
                        <li><strong>User VLANs (10, 20)：</strong> 用於 ESRP L2 Loop 檢測以及 L2 流量轉送 (當 MLAG Hash 到 Standby 時)。</li>
                        <li><strong>Routing VLAN (4094)：</strong> 獨立的 L3 介面，啟用 OSPF/RIP，讓 Core A 與 Core B 交換路由表。</li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-bold text-indigo-700 mb-2">關鍵參數 (Key Parameters)</h4>
                    <ul class="list-disc list-inside bg-gray-50 p-3 rounded text-sm font-mono">
                        <li>configure esrp "v1" add master "v10"</li>
                        <li>configure esrp "v2" add master "v20"</li>
                        <li><strong>configure ospf add vlan 4094 area 0.0.0.0</strong> (建立鄰居關係)</li>
                        <li><strong>configure ospf add vlan 10, 20 area 0.0.0.0</strong> (發佈業務網段路由)</li>
                        <li>Link Trunking: Tag All (ISC, 10, 20, 4094)</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 3: Visuals -->
        <section class="section-card">
            <div class="section-title">
                <i class="fa-solid fa-project-diagram"></i>
                三、架構視覺化 (Visuals)
            </div>
            
            <p class="mb-4 text-gray-600">下圖展示了 Access Switch 拆分後的雙活架構，以及 Core 層之間那條「全能」的互連鏈路。</p>

            <div class="mermaid-container">
                <!-- Diagram 3: ESRP Multi-Domain Architecture -->
                <div class="w-full text-center">
                    <h4 class="font-bold text-gray-700 mb-2">圖三：ESRP 多網域負載平衡架構 (Access 分流)</h4>
                    <div class="mermaid">
                        flowchart TD
                            CoreA["Core A<br/>(Master V10)<br/>(Standby V20)"]
                            CoreB["Core B<br/>(Master V20)<br/>(Standby V10)"]
                            AccessSW1["Access Switch 1<br/>(VLAN 10 Users)"]
                            AccessSW2["Access Switch 2<br/>(VLAN 20 Users)"]

                            %% Inter-Switch Link
                            CoreA ---|"ISC, V10, V20, V4094 (L3)"| CoreB
                            
                            %% MLAG Downlinks
                            CoreA ---|MLAG| AccessSW1
                            CoreB ---|MLAG| AccessSW1

                            CoreA ---|MLAG| AccessSW2
                            CoreB ---|MLAG| AccessSW2

                            %% Styling
                            style CoreA fill:#d4edda,stroke:#28a745,stroke-width:2px
                            style CoreB fill:#e2e8f0,stroke:#3182ce,stroke-width:2px
                            style AccessSW1 fill:#fff,stroke:#333,stroke-width:1px
                            style AccessSW2 fill:#fff,stroke:#333,stroke-width:1px
                            
                            linkStyle 0 stroke:purple,stroke-width:4px,color:purple
                    </div>
                    <p class="text-sm text-gray-500 mt-2">
                        <span class="inline-block w-3 h-3 bg-purple-600 mr-1"></span>紫色粗線：整合型 Trunk 鏈路，同時處理控制 (ISC)、資料 (V10/20) 與 路由 (V4094/OSPF)。
                    </p>
                </div>
            </div>
        </section>

        <!-- Section 4: Quiz -->
        <section class="section-card">
            <div class="section-title">
                <i class="fa-solid fa-clipboard-question"></i>
                四、隨堂測驗 (Quiz)
            </div>

            <div id="quiz-container" class="space-y-6">
                <!-- Generated by JS -->
            </div>
        </section>

    </div>

    <!-- Footer -->
    <footer>
        Planning & Design by Timmy(timmyc@hauman.com.tw) | 豪勉科技 Hauman Technologies Corporation | Ver 1.0
    </footer>

    <!-- Scripts -->
    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'default',
            flowchart: { curve: 'basis' },
            securityLevel: 'loose'
        });

        // Quiz Data
        const quizData = [
            {
                question: "1. 實作「ESRP 多網域負載平衡」的主要目的是什麼？",
                options: [
                    "A. 讓所有流量都只走一台 Switch",
                    "B. 讓兩台 Core Switch 分別擔任不同 VLAN 的 Master，充分利用硬體效能",
                    "C. 為了節省電費",
                    "D. 這是用來備份設定檔的"
                ],
                correct: "B",
                explanation: "這是本架構的核心，避免 Standby 設備閒置，讓兩台設備同時分擔不同網段的路由工作。"
            },
            {
                question: "2. 在圖三的架構中，Core Switch 之間的互連鏈路 (Trunk) 承載了哪些 VLAN？",
                options: [
                    "A. 只有 ISC VLAN",
                    "B. 只有 User VLAN (10, 20)",
                    "C. 包含 ISC、User VLANs (10, 20) 以及 Routing VLAN (4094)",
                    "D. 什麼都不承載，它是無線連接"
                ],
                correct: "C",
                explanation: "這條鏈路是關鍵樞紐，必須同時滿足 MLAG 同步 (ISC)、L2 備援 (User VLANs) 與 L3 路由交換 (Routing VLAN) 的需求。"
            },
            {
                question: "3. 若 Core A 是 VLAN 10 Master，Core B 是 VLAN 20 Master。當 Access Switch 1 (VLAN 10) 的流量 Hash 到 Core A 時，若要送到 VLAN 20，路徑為何？",
                options: [
                    "A. 丟棄封包",
                    "B. Core A 透過互連鏈路 (VLAN 4094) 路由給 Core B",
                    "C. 廣播給所有人",
                    "D. 透過 Console 線傳輸"
                ],
                correct: "B",
                explanation: "Core A 透過 OSPF 知道 V20 在 Core B，因此透過互連鏈路上的 L3 VLAN 轉送。"
            },
            {
                question: "4. 如果 MLAG 將 Access Switch 1 (V10) 的流量 Hash 到了 Core B (V10 Standby)，且 Core B 啟用了 `mode host`，它會怎麼做？",
                options: [
                    "A. 封包被丟棄",
                    "B. Core B 必須將封包送回 Core A 處理",
                    "C. Core B 可以直接進行本地路由 (Local Routing) 轉送給 V20 (因為它是 V20 Master)",
                    "D. Switch 當機"
                ],
                correct: "C",
                explanation: "因為 Core B 是 V20 的 Master (直連)，且 V10 啟用了 mode host，它可以直接處理這個路由請求，效率極高。"
            },
            {
                question: "5. 在此架構中，為什麼我們需要在 OSPF 中同時加入 VLAN 4094 和 VLAN 10, 20？",
                options: [
                    "A. 只是為了好玩",
                    "B. VLAN 4094 用於建立鄰居，VLAN 10/20 用於發佈業務網段路由",
                    "C. ESRP 要求一定要這樣設定，否則無法開機",
                    "D. 為了讓 DHCP 能夠運作"
                ],
                correct: "B",
                explanation: "如果只加入 VLAN 4094，兩台 Core 只是建立了關係但沒交換業務路由。必須加入 VLAN 10 與 20，對方才知道如何前往這些網段。"
            }
        ];

        // Render Quiz
        const quizContainer = document.getElementById('quiz-container');
        
        quizData.forEach((item, index) => {
            const qDiv = document.createElement('div');
            qDiv.className = 'border-b border-gray-200 pb-4 last:border-0';
            
            const title = document.createElement('h5');
            title.className = 'font-bold text-gray-800 mb-3';
            title.innerText = item.question;
            qDiv.appendChild(title);

            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'space-y-2';

            item.options.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'quiz-option p-3 rounded border border-gray-200 text-sm text-gray-700';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(btn, opt, item.correct, item.explanation, optionsDiv);
                optionsDiv.appendChild(btn);
            });

            const resultDiv = document.createElement('div');
            resultDiv.className = 'mt-3 p-3 rounded hidden text-sm';
            optionsDiv.appendChild(resultDiv);

            qDiv.appendChild(optionsDiv);
            quizContainer.appendChild(qDiv);
        });

        function checkAnswer(selectedBtn, selectedText, correctOption, explanation, parentDiv) {
            // Prevent multiple clicks
            if (parentDiv.querySelector('.answered')) return;
            
            const resultDiv = parentDiv.lastElementChild;
            const allBtns = parentDiv.querySelectorAll('.quiz-option');
            
            // Mark all as answered
            allBtns.forEach(b => b.classList.add('answered', 'cursor-default'));

            const isCorrect = selectedText.startsWith(correctOption);

            if (isCorrect) {
                selectedBtn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                resultDiv.innerHTML = `<i class="fa-solid fa-check-circle text-green-600 mr-2"></i><strong>答對了！</strong> ${explanation}`;
                resultDiv.classList.add('bg-green-50', 'text-green-800', 'border', 'border-green-200');
            } else {
                selectedBtn.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
                // Highlight correct one
                allBtns.forEach(b => {
                    if (b.innerText.startsWith(correctOption)) {
                        b.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                    }
                });
                resultDiv.innerHTML = `<i class="fa-solid fa-times-circle text-red-600 mr-2"></i><strong>答錯了。</strong> ${explanation}`;
                resultDiv.classList.add('bg-red-50', 'text-red-800', 'border', 'border-red-200');
            }
            resultDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>