<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExtremeXOS MLAG 互動式教學</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
        }
        
        .diagram-container {
            background-color: white;
            border-radius: 8px;
            padding: 30px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow-x: auto;
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
        }
        
        /* Ensure Diagram is Centered */
        .mermaid {
            display: flex;
            justify-content: center;
            width: 100%;
            background-color: white; /* 確保背景為白 */
        }

        .quiz-card {
            transition: all 0.3s ease;
        }
        .quiz-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-gradient-to-r from-purple-800 to-indigo-900 text-white shadow-lg">
        <div class="container mx-auto px-6 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold tracking-tight"><i class="fa-solid fa-network-wired mr-3"></i>ExtremeXOS 網路架構大師</h1>
                    <p class="mt-2 text-purple-200">主題：跨機箱鏈路聚合 (MLAG) 深度解析</p>
                </div>
                <div class="mt-4 md:mt-0 text-sm bg-white/10 px-4 py-2 rounded-full">
                    <i class="fa-solid fa-chalkboard-user mr-2"></i>講師：ExtremeXOS 架構師
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 flex-grow">

        <!-- Section 1: Concept -->
        <section class="mb-12 bg-white rounded-xl shadow-md overflow-hidden">
            <div class="border-l-8 border-purple-600 p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-purple-100 text-purple-800 py-1 px-3 rounded-full text-sm mr-3">Chapter 1</span>
                    核心概念 (Concept)
                </h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-semibold text-purple-700 mb-2">一句話定義</h3>
                        <p class="text-gray-600 leading-relaxed text-lg">
                            MLAG (Multi-Switch Link Aggregation Group) 是一種讓兩台獨立的交換器，在下游設備（如伺服器或其他交換器）眼中，偽裝成「同一台邏輯設備」的技術，藉此實現雙活 (Active-Active) 的冗餘與頻寬加成。
                        </p>
                    </div>
                    <div class="bg-purple-50 p-6 rounded-lg border border-purple-100">
                        <h3 class="text-lg font-semibold text-purple-700 mb-2"><i class="fa-solid fa-lightbulb text-yellow-500 mr-2"></i>生活化比喻</h3>
                        <p class="text-gray-700">
                            想像你在搬一張很重的沙發（流量）：
                            <br><br>
                            <strong>傳統 STP 模式：</strong> 像是一個人搬，另一個人站在旁邊看（備援），只有當第一個人累倒了，第二個人才接手。這很浪費人力。
                            <br><br>
                            <strong>MLAG 模式：</strong> 像是<strong>兩個默契極佳的搬家工人</strong>同時抬這張沙發。雖然他們是兩個獨立的人（兩台 Switch），但在沙發（下游設備）看來，這是一股統一向上的力量。
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Mechanism -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-gray-200 pb-2">二、運作原理 (Mechanism)</h2>
            
            <div class="bg-white rounded-xl shadow-sm p-8 border border-gray-100">
                <div class="grid lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">技術細節與封包流向</h3>
                        <ul class="space-y-4">
                            <li class="flex items-start">
                                <i class="fa-solid fa-check-circle text-green-500 mt-1 mr-3"></i>
                                <div>
                                    <strong class="text-gray-900">ISC (Inter-Switch Connection)：</strong>
                                    <p class="text-gray-600 text-sm mt-1">這是兩台 MLAG Peer 之間的生命線。它們透過 ISC 交換 MAC 位址表、ARP 表與 IGMP 資訊。這通常是一條 L2 Link (VLAN)。如果 ISC 斷了，MLAG 就會出現 Split-Brain (腦裂) 風險。</p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <i class="fa-solid fa-check-circle text-green-500 mt-1 mr-3"></i>
                                <div>
                                    <strong class="text-gray-900">LACP 欺騙 (Spoofing/Masquerading)：</strong>
                                    <p class="text-gray-600 text-sm mt-1">
                                        為了讓下游設備以為它連接的是同一台交換器，兩台 Extreme 交換器會協商出一個共用的 <strong>System ID</strong> (通常是 MAC Address)。當發送 LACP 封包時，兩台設備都使用這個相同的 ID。
                                    </p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <i class="fa-solid fa-check-circle text-green-500 mt-1 mr-3"></i>
                                <div>
                                    <strong class="text-gray-900">流量轉發 (Traffic Forwarding)：</strong>
                                    <p class="text-gray-600 text-sm mt-1">正常情況下，流量會在本地轉發 (Local switching)。只有當連線單邊失效，或者需要跨設備轉發廣播/群播時，流量才會走 ISC 通道。</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ExtremeXOS 關鍵參數</h3>
                        <code class="block text-sm font-mono text-blue-600 bg-gray-100 p-2 rounded mb-2">create mlag peer &lt;name&gt;</code>
                        <p class="text-xs text-gray-500 mb-4">建立對等體關係</p>
                        
                        <code class="block text-sm font-mono text-blue-600 bg-gray-100 p-2 rounded mb-2">enable mlag port &lt;port&gt; peer &lt;name&gt; id &lt;id&gt;</code>
                        <p class="text-xs text-gray-500 mb-4">將特定 Port 加入 MLAG 群組</p>
                        
                        <div class="mt-6 border-t pt-4">
                            <h4 class="text-sm font-bold text-gray-700">廠商術語對照</h4>
                            <div class="grid grid-cols-2 gap-2 mt-2 text-sm">
                                <div class="font-semibold">Extreme</div>
                                <div class="font-semibold text-gray-500">Cisco</div>
                                <div>MLAG</div>
                                <div class="text-gray-500">vPC</div>
                                <div>ISC</div>
                                <div class="text-gray-500">Peer-Link</div>
                                <div>SLAG/LACP</div>
                                <div class="text-gray-500">Port-Channel</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Visuals -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-gray-200 pb-2">三、架構視覺化 (Visuals)</h2>
            
            <!-- Topology Diagram -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">1. 實體拓撲架構圖 (Topology)</h3>
                <div class="diagram-container">
                    <!-- Mermaid Container -->
                    <div class="mermaid">
graph TD
    %% 定義樣式 Class
    classDef mlagNode fill:#6200ea,stroke:#333,stroke-width:2px,color:#fff,rx:5,ry:5,font-size:16px
    classDef clientNode fill:#fff,stroke:#6200ea,stroke-width:2px,color:#333,rx:5,ry:5,font-size:16px

    %% 上半部：MLAG Core
    subgraph MLAG_System ["ExtremeXOS MLAG System"]
        direction LR
        SW1("Switch A<br/>(Peer 1)"):::mlagNode
        SW2("Switch B<br/>(Peer 2)"):::mlagNode
    end

    %% 下半部：Client
    subgraph Client_System ["Downstream"]
        SVR("Critical Server<br/>or Access Switch"):::clientNode
    end

    %% ISC 連線：重點標示 VLAN 與 LACP
    %% 修正：ISC 需同時帶有 Control VLAN (ISC) 與 Data VLAN (Service)
    SW1 <==>|"LACP Trunk<br/>(Tags: ISC-VLAN & Service-VLAN)"| SW2

    %% 下行連線：重點標示 Service VLAN
    %% 修正：使用雙引號包覆標籤內容
    SW1 ===|"Link 1<br/>(Tag: Service-VLAN)"| SVR
    SW2 ===|"Link 2<br/>(Tag: Service-VLAN)"| SVR
                    </div>
                    <p class="text-center text-sm text-gray-500 mt-4">
                        圖說：上方水平連線為 <strong>ISC 通道</strong> (LACP Trunk)，需同時允許 <strong>ISC-VLAN</strong> (同步用) 與 <strong>Service-VLAN</strong> (資料用) 通過。<br>
                        下方垂直連線為 <strong>資料通道</strong>，承載實際業務流量。
                    </p>
                </div>
            </div>

            <!-- Sequence Diagram -->
            <div>
                <h3 class="text-lg font-semibold text-gray-700 mb-3">2. LACP 協商與同步流程 (Sequence)</h3>
                <div class="diagram-container">
                    <div class="mermaid">
sequenceDiagram
    participant Server as Downstream Device
    participant SW1 as Switch A (MLAG)
    participant SW2 as Switch B (MLAG)
    
    Note over SW1, SW2: 1. ISC 建立 (LACP Trunk)
    Note over SW1, SW2: 同步 MAC / ARP 表 (經 ISC-VLAN)
    
    rect rgb(240, 248, 255)
    Note over Server, SW2: 2. LACP 協商 (Service VLAN)
    Server->>SW1: LACP Request (Actor: Server)
    Server->>SW2: LACP Request (Actor: Server)
    
    Note over SW1, SW2: Peers 使用相同 System ID 回應
    
    SW1-->>Server: LACP Response (ID: Shared-MAC)
    SW2-->>Server: LACP Response (ID: Shared-MAC)
    end
    
    Note over Server: Server 成功建立 20G 邏輯通道
    
    rect rgb(240, 255, 240)
    Note over Server, SW2: 3. 資料轉發 (Active-Active)
    Server->>SW1: Data Packet 1 (Hash A)
    Server->>SW2: Data Packet 2 (Hash B)
    end
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Use Case -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-gray-200 pb-2">四、實務應用場景 (Use Case)</h2>
            
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="md:w-1/2">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">企業案例：核心資料中心伺服器接入</h3>
                        <p class="text-gray-600 mb-4">
                            某金融業客戶的交易伺服器 (Trading Server) 絕對不能斷線。
                            <br><br>
                            <strong>部署方式：</strong>
                            我們在機櫃上方部署兩台 Extreme 交換器設定 MLAG。伺服器的兩張網卡設定 Teaming (LACP 模式)，分別接往兩台交換器。
                            <br><br>
                            <strong>情境模擬：</strong>
                            當我們需要對 "Switch A" 進行韌體升級重啟時，因為 MLAG 是雙活架構，流量會瞬間全部切換到 "Switch B"，伺服器端的服務<strong>完全不中斷 (Zero Downtime)</strong>。
                        </p>
                    </div>
                    <div class="md:w-1/2 bg-gray-50 p-4 rounded-lg border-l-4 border-indigo-500">
                        <h4 class="font-bold text-indigo-700 mb-3">為什麼不使用 Stacking (堆疊)?</h4>
                        <div class="space-y-3">
                            <div class="flex items-start">
                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded mr-2">MLAG 優點</span>
                                <p class="text-sm text-gray-600"><strong>獨立控制層 (Control Plane)：</strong> 兩台設備OS獨立，一台當機或升級，不會影響另一台。</p>
                            </div>
                            <div class="flex items-start">
                                <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded mr-2">MLAG 缺點</span>
                                <p class="text-sm text-gray-600"><strong>管理複雜度：</strong> 需要分別管理兩台設備的設定檔，設定較繁瑣 (需確保參數一致)。</p>
                            </div>
                            <div class="flex items-start">
                                <span class="bg-gray-200 text-gray-800 text-xs px-2 py-1 rounded mr-2">Stacking</span>
                                <p class="text-sm text-gray-600">雖然管理簡單 (視為一台)，但韌體升級通常需要整堆重啟，造成服務中斷。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Quiz -->
        <section class="mb-16">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-gray-200 pb-2">五、隨堂測驗 (Quiz)</h2>
            
            <div class="space-y-4">
                <!-- Question 1 -->
                <div class="quiz-card bg-white p-6 rounded-lg shadow border border-gray-100">
                    <p class="font-bold text-lg text-gray-800 mb-3">Q1. 在 MLAG 架構中，下游設備 (如 Server) 認為它連接了幾台交換器？</p>
                    <div class="flex justify-between items-center">
                        <button onclick="toggleAnswer('a1')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm transition">
                            顯示答案與解析
                        </button>
                    </div>
                    <div id="a1" class="hidden mt-4 p-4 bg-green-50 rounded border border-green-200">
                        <p class="font-bold text-green-800">答案：一台</p>
                        <p class="text-sm text-green-700 mt-1">解析：這就是 MLAG 的核心目的。透過 LACP System ID 的欺騙/同步，下游設備將兩台實體交換器視為單一邏輯設備。</p>
                    </div>
                </div>

                <!-- Question 2 -->
                <div class="quiz-card bg-white p-6 rounded-lg shadow border border-gray-100">
                    <p class="font-bold text-lg text-gray-800 mb-3">Q2. 兩台 MLAG Peer 之間的連接線路 (Link) 在 ExtremeXOS 中稱為什麼？</p>
                    <div class="flex justify-between items-center">
                        <button onclick="toggleAnswer('a2')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm transition">
                            顯示答案與解析
                        </button>
                    </div>
                    <div id="a2" class="hidden mt-4 p-4 bg-green-50 rounded border border-green-200">
                        <p class="font-bold text-green-800">答案：ISC (Inter-Switch Connection)</p>
                        <p class="text-sm text-green-700 mt-1">解析：ISC 用於同步 MAC 表、ARP 表與 LACP 狀態。Cisco 則稱為 vPC Peer-Link。</p>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="quiz-card bg-white p-6 rounded-lg shadow border border-gray-100">
                    <p class="font-bold text-lg text-gray-800 mb-3">Q3. 相較於 Stacking (堆疊)，MLAG 在「韌體升級」時最大的優勢是什麼？</p>
                    <div class="flex justify-between items-center">
                        <button onclick="toggleAnswer('a3')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm transition">
                            顯示答案與解析
                        </button>
                    </div>
                    <div id="a3" class="hidden mt-4 p-4 bg-green-50 rounded border border-green-200">
                        <p class="font-bold text-green-800">答案：可以獨立升級而不中斷服務 (Zero Downtime)</p>
                        <p class="text-sm text-green-700 mt-1">解析：Stacking 通常共用一個 Control Plane，升級往往導致整個 Stack 重啟。MLAG 兩台設備獨立運作，可輪流升級。</p>
                    </div>
                </div>

                <!-- Question 4 -->
                <div class="quiz-card bg-white p-6 rounded-lg shadow border border-gray-100">
                    <p class="font-bold text-lg text-gray-800 mb-3">Q4. 如果 ISC 連線斷開，但兩台 Switch 都還活著，這會造成什麼風險？</p>
                    <div class="flex justify-between items-center">
                        <button onclick="toggleAnswer('a4')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm transition">
                            顯示答案與解析
                        </button>
                    </div>
                    <div id="a4" class="hidden mt-4 p-4 bg-green-50 rounded border border-green-200">
                        <p class="font-bold text-green-800">答案：腦裂 (Split-Brain) 或 雙重主機 (Dual-Active)</p>
                        <p class="text-sm text-green-700 mt-1">解析：兩台 Switch 無法同步狀態，可能會各自回應 ARP 或導致 LACP 協商混亂，引起網路迴圈或封包遺失。</p>
                    </div>
                </div>

                <!-- Question 5 -->
                <div class="quiz-card bg-white p-6 rounded-lg shadow border border-gray-100">
                    <p class="font-bold text-lg text-gray-800 mb-3">Q5. 在 ExtremeXOS 中，哪一個指令可以用來檢查 MLAG peer 的狀態？</p>
                    <div class="flex justify-between items-center">
                        <button onclick="toggleAnswer('a5')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm transition">
                            顯示答案與解析
                        </button>
                    </div>
                    <div id="a5" class="hidden mt-4 p-4 bg-green-50 rounded border border-green-200">
                        <p class="font-bold text-green-800">答案：show mlag peer</p>
                        <p class="text-sm text-green-700 mt-1">解析：此指令可以顯示 Peer 是否 "Up"、驗證狀態 (Authentication) 以及 ISC 是否正常。</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-6 text-center border-t border-gray-800">
        <div class="container mx-auto px-4">
            <p class="text-sm">
                Planning & Design by Timmy (<a href="mailto:timmyc@hauman.com.tw" class="hover:text-white transition">timmyc@hauman.com.tw</a>)
            </p>
            <p class="text-sm mt-1">
                豪勉科技 Hauman Technologies Corporation | Ver 1.0
            </p>
        </div>
    </footer>

    <!-- Interactive Script (ES Module Import for Mermaid v10) -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

        // Initialize with your custom settings
        mermaid.initialize({
            startOnLoad: false, // We will manually run it
            theme: 'default',
            fontFamily: 'Noto Sans TC',
            flowchart: {
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                actorFontSize: 18,
                noteFontSize: 16,
                messageFontSize: 18
            }
        });

        // Run mermaid when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            await mermaid.run({
                nodes: document.querySelectorAll('.mermaid'),
            });
        });

        // Global function for quiz (needs to be attached to window in module mode)
        window.toggleAnswer = function(id) {
            const answerDiv = document.getElementById(id);
            if (answerDiv.classList.contains('hidden')) {
                answerDiv.classList.remove('hidden');
            } else {
                answerDiv.classList.add('hidden');
            }
        };
    </script>
</body>
</html>